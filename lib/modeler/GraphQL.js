"use strict";

require("source-map-support/register");

const path = require('path');

const {
  _,
  fs,
  pascalCase,
  replaceAll,
  putIntoBucket
} = require('rk-utils');

const {
  toGraphQLType
} = require('./graphql/lang');

class GraphQLModeler {
  constructor(context, connector) {
    this.linker = context.linker;
    this.outputPath = context.modelPath;
    this.manifestPath = context.manifestPath;
    this.connector = connector;
  }

  modeling_(schema) {
    this.linker.log('info', 'Generating graphql models for schema "' + schema.name + '"...');

    this._generateGraphQLModel(schema);
  }

  _generateEnumTypes(schema) {
    _.forOwn(schema.entities, (entity, entityInstanceName) => {
      _.forOwn(entity.fields, (field, fieldName) => {
        if (field.type === 'enum') {}
      });
    });
  }

  _generateGraphQLModel(schema) {
    const generated = new Set();
    const typeDefs = [];

    _.forOwn(schema.entities, (entity, entityInstanceName) => {
      let capitalized = pascalCase(entityInstanceName);

      let fields = _.map(entity.fields, (field, fieldName) => {
        if (fieldName === entity.key) {
          return `${fieldName}: ID!`;
        }

        const typeInfo = toGraphQLType(field);

        if (typeInfo.newType) {
          if (!generated.has(typeInfo.newType)) {
            generated.add(typeInfo.newType);

            switch (typeInfo.typeName) {
              case 'scalar':
                typeDefs.push(`scalar ${typeInfo.newType}`);
                break;

              case 'enum':
                typeDefs.push(`enum ${typeInfo.newType} {
    ${typeInfo.values.map(v => _.snakeCase(v).toUpperCase()).join('\n    ')}
}`);
                break;

              default:
                throw new Error(`Unsupported graphql type: ${typeInfo.newType}`);
            }
          }
        }

        return `${fieldName}: ${typeInfo.type}`;
      });

      if (_.isEmpty(!entity.associations)) {
        _.each(entity.associations, (assoc, anchor) => {
          const typeName = pascalCase(assoc.entity);

          if (assoc.list) {
            fields.push(`${anchor}_: [${typeName}!]`);
          } else {
            fields.push(`${anchor}_: ${typeName}`);
          }
        });
      }

      let classCode = `type ${capitalized} {
    ${fields.join('\n    ')}
}`;
      typeDefs.push(classCode);
    });

    let modelFilePath = path.resolve(this.manifestPath, 'graphql', schema.name + '.graphql');
    fs.ensureFileSync(modelFilePath);
    fs.writeFileSync(modelFilePath, typeDefs.join('\n\n'));
    this.linker.log('info', 'Generated graphql model: ' + modelFilePath);
  }

  _generateEntityManifest(schema) {
    let entities = Object.keys(schema.entities).sort().reduce((result, v) => {
      result[v] = {};
      return result;
    }, {});
    let outputFilePath = path.resolve(this.manifestPath, schema.name + '.manifest.json');
    fs.ensureFileSync(outputFilePath);
    fs.writeFileSync(outputFilePath, JSON.stringify(entities, null, 4));
    this.linker.log('info', 'Generated schema manifest: ' + outputFilePath);
  }

}

module.exports = GraphQLModeler;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9tb2RlbGVyL0dyYXBoUUwuanMiXSwibmFtZXMiOlsicGF0aCIsInJlcXVpcmUiLCJfIiwiZnMiLCJwYXNjYWxDYXNlIiwicmVwbGFjZUFsbCIsInB1dEludG9CdWNrZXQiLCJ0b0dyYXBoUUxUeXBlIiwiR3JhcGhRTE1vZGVsZXIiLCJjb25zdHJ1Y3RvciIsImNvbnRleHQiLCJjb25uZWN0b3IiLCJsaW5rZXIiLCJvdXRwdXRQYXRoIiwibW9kZWxQYXRoIiwibWFuaWZlc3RQYXRoIiwibW9kZWxpbmdfIiwic2NoZW1hIiwibG9nIiwibmFtZSIsIl9nZW5lcmF0ZUdyYXBoUUxNb2RlbCIsIl9nZW5lcmF0ZUVudW1UeXBlcyIsImZvck93biIsImVudGl0aWVzIiwiZW50aXR5IiwiZW50aXR5SW5zdGFuY2VOYW1lIiwiZmllbGRzIiwiZmllbGQiLCJmaWVsZE5hbWUiLCJ0eXBlIiwiZ2VuZXJhdGVkIiwiU2V0IiwidHlwZURlZnMiLCJjYXBpdGFsaXplZCIsIm1hcCIsImtleSIsInR5cGVJbmZvIiwibmV3VHlwZSIsImhhcyIsImFkZCIsInR5cGVOYW1lIiwicHVzaCIsInZhbHVlcyIsInYiLCJzbmFrZUNhc2UiLCJ0b1VwcGVyQ2FzZSIsImpvaW4iLCJFcnJvciIsImlzRW1wdHkiLCJhc3NvY2lhdGlvbnMiLCJlYWNoIiwiYXNzb2MiLCJhbmNob3IiLCJsaXN0IiwiY2xhc3NDb2RlIiwibW9kZWxGaWxlUGF0aCIsInJlc29sdmUiLCJlbnN1cmVGaWxlU3luYyIsIndyaXRlRmlsZVN5bmMiLCJfZ2VuZXJhdGVFbnRpdHlNYW5pZmVzdCIsIk9iamVjdCIsImtleXMiLCJzb3J0IiwicmVkdWNlIiwicmVzdWx0Iiwib3V0cHV0RmlsZVBhdGgiLCJKU09OIiwic3RyaW5naWZ5IiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7QUFFQSxNQUFNQSxJQUFJLEdBQUdDLE9BQU8sQ0FBQyxNQUFELENBQXBCOztBQUNBLE1BQU07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YyxNQUFkLENBQWhDO0FBRUEsU0FBS2xDLE1BQUwsQ0FBWU0sR0FBWixDQUFnQixNQUFoQixFQUF3Qiw4QkFBOEJxQyxhQUF0RDtBQUNIOztBQUVESSxFQUFBQSx1QkFBdUIsQ0FBQzFDLE1BQUQsRUFBUztBQUM1QixRQUFJTSxRQUFRLEdBQUdxQyxNQUFNLENBQUNDLElBQVAsQ0FBWTVDLE1BQU0sQ0FBQ00sUUFBbkIsRUFBNkJ1QyxJQUE3QixHQUFvQ0MsTUFBcEMsQ0FBMkMsQ0FBQ0MsTUFBRCxFQUFTckIsQ0FBVCxLQUFlO0FBQUVxQixNQUFBQSxNQUFNLENBQUNyQixDQUFELENBQU4sR0FBWSxFQUFaO0FBQWdCLGFBQU9xQixNQUFQO0FBQWdCLEtBQTVGLEVBQThGLEVBQTlGLENBQWY7QUFvREEsUUFBSUMsY0FBYyxHQUFHakUsSUFBSSxDQUFDd0QsT0FBTCxDQUFhLEtBQUt6QyxZQUFsQixFQUFnQ0UsTUFBTSxDQUFDRSxJQUFQLEdBQWMsZ0JBQTlDLENBQXJCO0FBQ0FoQixJQUFBQSxFQUFFLENBQUNzRCxjQUFILENBQWtCUSxjQUFsQjtBQUNBOUQsSUFBQUEsRUFBRSxDQUFDdUQsYUFBSCxDQUFpQk8sY0FBakIsRUFBaUNDLElBQUksQ0FBQ0MsU0FBTCxDQUFlNUMsUUFBZixFQUF5QixJQUF6QixFQUErQixDQUEvQixDQUFqQztBQUVBLFNBQUtYLE1BQUwsQ0FBWU0sR0FBWixDQUFnQixNQUFoQixFQUF3QixnQ0FBZ0MrQyxjQUF4RDtBQUNIOztBQWpMZ0I7O0FBMlJyQkcsTUFBTSxDQUFDQyxPQUFQLEdBQWlCN0QsY0FBakIiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcblxuY29uc3QgcGF0aCA9IHJlcXVpcmUoJ3BhdGgnKTtcbmNvbnN0IHsgXywgZnMsIHBhc2NhbENhc2UsIHJlcGxhY2VBbGwsIHB1dEludG9CdWNrZXQgfSAgPSByZXF1aXJlKCdyay11dGlscycpO1xuXG5jb25zdCB7IHRvR3JhcGhRTFR5cGUgfSA9IHJlcXVpcmUoJy4vZ3JhcGhxbC9sYW5nJyk7XG5cbi8qKlxuICogR3JhcGhRTCBzY2hlbWFzIG1vZGVsZXIuXG4gKiBAY2xhc3NcbiAqL1xuY2xhc3MgR3JhcGhRTE1vZGVsZXIge1xuICAgIC8qKiAgICAgXG4gICAgICogQHBhcmFtIHtvYmplY3R9IGNvbnRleHQgICBcbiAgICAgKiBAcHJvcGVydHkge0dlbWxMaW5rZXJ9IGNvbnRleHQubGlua2VyIC0gR2VtbCBsaW5rZXJcbiAgICAgKiBAcHJvcGVydHkge29iamVjdH0gY29udGV4dC5tb2RlbFBhdGggLSBHZW5lcmF0ZWQgbW9kZWwgb3V0cHV0IHBhdGhcbiAgICAgKiBAcHJvcGVydHkge29iamVjdH0gY29udGV4dC5tYW5pZmVzdFBhdGggLSBFbnRpdGllcyBtYW5pZmVzdCBvdXRwdXQgcGF0aFxuICAgICAqIEBwYXJhbSB7Q29ubmVjdG9yfSBjb25uZWN0b3IgICAgICBcbiAgICAgKi9cbiAgICBjb25zdHJ1Y3Rvcihjb250ZXh0LCBjb25uZWN0b3IpIHsgICAgICAgXG4gICAgICAgIHRoaXMubGlua2VyID0gY29udGV4dC5saW5rZXI7XG4gICAgICAgIHRoaXMub3V0cHV0UGF0aCA9IGNvbnRleHQubW9kZWxQYXRoO1xuICAgICAgICB0aGlzLm1hbmlmZXN0UGF0aCA9IGNvbnRleHQubWFuaWZlc3RQYXRoO1xuXG4gICAgICAgIHRoaXMuY29ubmVjdG9yID0gY29ubmVjdG9yOyAgICAgICAgXG4gICAgfVxuXG4gICAgbW9kZWxpbmdfKHNjaGVtYSkge1xuICAgICAgICB0aGlzLmxpbmtlci5sb2coJ2luZm8nLCAnR2VuZXJhdGluZyBncmFwaHFsIG1vZGVscyBmb3Igc2NoZW1hIFwiJyArIHNjaGVtYS5uYW1lICsgJ1wiLi4uJyk7XG5cbiAgICAgICAgLy90aGlzLl9nZW5lcmF0ZVNjaGVtYU1vZGVsKHNjaGVtYSk7ICAgICAgICBcbiAgICAgICAgdGhpcy5fZ2VuZXJhdGVHcmFwaFFMTW9kZWwoc2NoZW1hKTtcbiAgICB9XG5cbiAgICAvKlxuICAgIF9nZW5lcmF0ZVNjaGVtYU1vZGVsKHNjaGVtYSkge1xuICAgICAgICBsZXQgY2FwaXRhbGl6ZWQgPSBwYXNjYWxDYXNlKHNjaGVtYS5uYW1lKTtcblxuICAgICAgICBsZXQgbG9jYWxzID0ge1xuICAgICAgICAgICAgZHJpdmVyOiB0aGlzLmNvbm5lY3Rvci5kcml2ZXIsXG4gICAgICAgICAgICBjbGFzc05hbWU6IGNhcGl0YWxpemVkLFxuICAgICAgICAgICAgc2NoZW1hTmFtZTogc2NoZW1hLm5hbWUsXG4gICAgICAgICAgICBlbnRpdGllczogSlNPTi5zdHJpbmdpZnkoT2JqZWN0LmtleXMoc2NoZW1hLmVudGl0aWVzKSlcbiAgICAgICAgfTtcblxuICAgICAgICBsZXQgY2xhc3NUZW1wbGF0ZSA9IHBhdGgucmVzb2x2ZShfX2Rpcm5hbWUsICdkYXRhYmFzZScsIHRoaXMuY29ubmVjdG9yLmRyaXZlciwgJ0RhdGFiYXNlLmpzLnN3aWcnKTtcbiAgICAgICAgbGV0IGNsYXNzQ29kZSA9IHN3aWcucmVuZGVyRmlsZShjbGFzc1RlbXBsYXRlLCBsb2NhbHMpO1xuXG4gICAgICAgIGxldCBtb2RlbEZpbGVQYXRoID0gcGF0aC5yZXNvbHZlKHRoaXMub3V0cHV0UGF0aCwgY2FwaXRhbGl6ZWQgKyAnLmpzJyk7XG4gICAgICAgIGZzLmVuc3VyZUZpbGVTeW5jKG1vZGVsRmlsZVBhdGgpO1xuICAgICAgICBmcy53cml0ZUZpbGVTeW5jKG1vZGVsRmlsZVBhdGgsIGNsYXNzQ29kZSk7XG5cbiAgICAgICAgdGhpcy5saW5rZXIubG9nKCdpbmZvJywgJ0dlbmVyYXRlZCBkYXRhYmFzZSBtb2RlbDogJyArIG1vZGVsRmlsZVBhdGgpO1xuICAgIH0qL1xuXG4gICAgX2dlbmVyYXRlRW51bVR5cGVzKHNjaGVtYSkge1xuICAgICAgICBfLmZvck93bihzY2hlbWEuZW50aXRpZXMsIChlbnRpdHksIGVudGl0eUluc3RhbmNlTmFtZSkgPT4ge1xuICAgICAgICAgICAgXy5mb3JPd24oZW50aXR5LmZpZWxkcywgKGZpZWxkLCBmaWVsZE5hbWUpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoZmllbGQudHlwZSA9PT0gJ2VudW0nKSB7XG5cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgX2dlbmVyYXRlR3JhcGhRTE1vZGVsKHNjaGVtYSkge1xuICAgICAgICBjb25zdCBnZW5lcmF0ZWQgPSBuZXcgU2V0KCk7XG5cbiAgICAgICAgY29uc3QgdHlwZURlZnMgPSBbXTtcblxuICAgICAgICBfLmZvck93bihzY2hlbWEuZW50aXRpZXMsIChlbnRpdHksIGVudGl0eUluc3RhbmNlTmFtZSkgPT4geyAgICAgICAgICAgIFxuICAgICAgICAgICAgbGV0IGNhcGl0YWxpemVkID0gcGFzY2FsQ2FzZShlbnRpdHlJbnN0YW5jZU5hbWUpOyAgICAgICAgICAgICAgICAgIFxuXG4gICAgICAgICAgICBsZXQgZmllbGRzID0gXy5tYXAoZW50aXR5LmZpZWxkcywgKGZpZWxkLCBmaWVsZE5hbWUpID0+IHsgIFxuICAgICAgICAgICAgICAgIGlmIChmaWVsZE5hbWUgPT09IGVudGl0eS5rZXkpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGAke2ZpZWxkTmFtZX06IElEIWA7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgY29uc3QgdHlwZUluZm8gPSB0b0dyYXBoUUxUeXBlKGZpZWxkKTsgICAgXG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgaWYgKHR5cGVJbmZvLm5ld1R5cGUpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFnZW5lcmF0ZWQuaGFzKHR5cGVJbmZvLm5ld1R5cGUpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBnZW5lcmF0ZWQuYWRkKHR5cGVJbmZvLm5ld1R5cGUpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKHR5cGVJbmZvLnR5cGVOYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnc2NhbGFyJzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZURlZnMucHVzaChgc2NhbGFyICR7dHlwZUluZm8ubmV3VHlwZX1gKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdlbnVtJzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZURlZnMucHVzaChgZW51bSAke3R5cGVJbmZvLm5ld1R5cGV9IHtcbiAgICAke3R5cGVJbmZvLnZhbHVlcy5tYXAodiA9PiBfLnNuYWtlQ2FzZSh2KS50b1VwcGVyQ2FzZSgpKS5qb2luKCdcXG4gICAgJyl9XG59YCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBVbnN1cHBvcnRlZCBncmFwaHFsIHR5cGU6ICR7dHlwZUluZm8ubmV3VHlwZX1gKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSBcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgcmV0dXJuIGAke2ZpZWxkTmFtZX06ICR7dHlwZUluZm8udHlwZX1gO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGlmIChfLmlzRW1wdHkoIWVudGl0eS5hc3NvY2lhdGlvbnMpKSB7XG4gICAgICAgICAgICAgICAgXy5lYWNoKGVudGl0eS5hc3NvY2lhdGlvbnMsIChhc3NvYywgYW5jaG9yKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHR5cGVOYW1lID0gcGFzY2FsQ2FzZShhc3NvYy5lbnRpdHkpO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChhc3NvYy5saXN0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmaWVsZHMucHVzaChgJHthbmNob3J9XzogWyR7dHlwZU5hbWV9IV1gKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpZWxkcy5wdXNoKGAke2FuY2hvcn1fOiAke3R5cGVOYW1lfWApO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGxldCBjbGFzc0NvZGUgPSBgdHlwZSAke2NhcGl0YWxpemVkfSB7XG4gICAgJHtmaWVsZHMuam9pbignXFxuICAgICcpfVxufWA7ICAgICAgICAgICAgICAgICAgICAgICAgIFxuXG4gICAgICAgICAgICB0eXBlRGVmcy5wdXNoKGNsYXNzQ29kZSk7ICAgICAgICAgICAgXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGxldCBtb2RlbEZpbGVQYXRoID0gcGF0aC5yZXNvbHZlKHRoaXMubWFuaWZlc3RQYXRoLCAnZ3JhcGhxbCcsIHNjaGVtYS5uYW1lICsgJy5ncmFwaHFsJyk7XG4gICAgICAgIGZzLmVuc3VyZUZpbGVTeW5jKG1vZGVsRmlsZVBhdGgpO1xuICAgICAgICBmcy53cml0ZUZpbGVTeW5jKG1vZGVsRmlsZVBhdGgsIHR5cGVEZWZzLmpvaW4oJ1xcblxcbicpKTtcblxuICAgICAgICB0aGlzLmxpbmtlci5sb2coJ2luZm8nLCAnR2VuZXJhdGVkIGdyYXBocWwgbW9kZWw6ICcgKyBtb2RlbEZpbGVQYXRoKTtcbiAgICB9XG5cbiAgICBfZ2VuZXJhdGVFbnRpdHlNYW5pZmVzdChzY2hlbWEpIHtcbiAgICAgICAgbGV0IGVudGl0aWVzID0gT2JqZWN0LmtleXMoc2NoZW1hLmVudGl0aWVzKS5zb3J0KCkucmVkdWNlKChyZXN1bHQsIHYpID0+IHsgcmVzdWx0W3ZdID0ge307IHJldHVybiByZXN1bHQ7IH0sIHt9KTtcbiAgICAgICAgLypcbiAgICAgICAgbGV0IG1hbmlmZXN0ID0ge307XG5cbiAgICAgICAgXy5lYWNoKHNjaGVtYS5lbnRpdGllcywgKGVudGl0eSwgZW50aXR5TmFtZSkgPT4ge1xuICAgICAgICAgICAgaWYgKGVudGl0eS5pbmZvLnJlc3RmdWwpIHtcbiAgICAgICAgICAgICAgICBfLmVhY2goZW50aXR5LmluZm8ucmVzdGZ1bCwgKHsgdHlwZSwgbWV0aG9kcyB9LCByZWxhdGl2ZVVyaSkgPT4geyAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgIGxldCBhcGlJbmZvID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZHM6IHt9ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZSA9PT0gJ2VudGl0eScpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFwaUluZm8uZW50aXR5ID0gZW50aXR5TmFtZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFwaUluZm8uZGlzcGxheU5hbWUgPSBlbnRpdHkuZGlzcGxheU5hbWU7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlbnRpdHkuY29tbWVudCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFwaUluZm8uZGVzY3JpcHRpb24gPSBlbnRpdHkuY29tbWVudDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIF8uZWFjaChtZXRob2RzLCAobWV0YSwgbWV0aG9kTmFtZSkgPT4ge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKG1ldGhvZE5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdjcmVhdGUnOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcGlJbmZvLm1ldGhvZHNbJ3Bvc3Q6JyArIHJlbGF0aXZlVXJpXSA9IG1ldGE7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdmaW5kT25lJzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ2ZpbmVBbGwnOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAndXBkYXRlT25lJzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ3VwZGF0ZU1hbnknOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnZGVsZXRlT25lJzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ2RlbGV0ZU1hbnknOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgKi9cbiAgICAgICAgbGV0IG91dHB1dEZpbGVQYXRoID0gcGF0aC5yZXNvbHZlKHRoaXMubWFuaWZlc3RQYXRoLCBzY2hlbWEubmFtZSArICcubWFuaWZlc3QuanNvbicpO1xuICAgICAgICBmcy5lbnN1cmVGaWxlU3luYyhvdXRwdXRGaWxlUGF0aCk7XG4gICAgICAgIGZzLndyaXRlRmlsZVN5bmMob3V0cHV0RmlsZVBhdGgsIEpTT04uc3RyaW5naWZ5KGVudGl0aWVzLCBudWxsLCA0KSk7XG5cbiAgICAgICAgdGhpcy5saW5rZXIubG9nKCdpbmZvJywgJ0dlbmVyYXRlZCBzY2hlbWEgbWFuaWZlc3Q6ICcgKyBvdXRwdXRGaWxlUGF0aCk7XG4gICAgfVxuXG4gICAgLypcbiAgICBfZ2VuZXJhdGVWaWV3TW9kZWwoc2NoZW1hLCBkYlNlcnZpY2UpIHsgICAgICAgIFxuICAgICAgICBfLmZvck93bihzY2hlbWEudmlld3MsICh2aWV3SW5mbywgdmlld05hbWUpID0+IHtcbiAgICAgICAgICAgIHRoaXMubGlua2VyLmluZm8oJ0J1aWxkaW5nIHZpZXc6ICcgKyB2aWV3TmFtZSk7XG5cbiAgICAgICAgICAgIGxldCBjYXBpdGFsaXplZCA9IF8udXBwZXJGaXJzdCh2aWV3TmFtZSk7XG5cbiAgICAgICAgICAgIGxldCBhc3QgPSBKc0xhbmcuYXN0UHJvZ3JhbSgpO1xuXG4gICAgICAgICAgICBKc0xhbmcuYXN0UHVzaEluQm9keShhc3QsIEpzTGFuZy5hc3RSZXF1aXJlKCdNb3dhJywgJ21vd2EnKSk7XG4gICAgICAgICAgICBKc0xhbmcuYXN0UHVzaEluQm9keShhc3QsIEpzTGFuZy5hc3RWYXJEZWNsYXJlKCdVdGlsJywgSnNMYW5nLmFzdFZhclJlZignTW93YS5VdGlsJyksIHRydWUpKTtcbiAgICAgICAgICAgIEpzTGFuZy5hc3RQdXNoSW5Cb2R5KGFzdCwgSnNMYW5nLmFzdFZhckRlY2xhcmUoJ18nLCBKc0xhbmcuYXN0VmFyUmVmKCdVdGlsLl8nKSwgdHJ1ZSkpO1xuICAgICAgICAgICAgSnNMYW5nLmFzdFB1c2hJbkJvZHkoYXN0LCBKc0xhbmcuYXN0UmVxdWlyZSgnVmlldycsICdtb3dhL2xpYi9vb2xvbmcvcnVudGltZS92aWV3JykpO1xuXG4gICAgICAgICAgICBsZXQgY29tcGlsZUNvbnRleHQgPSBPb2xUb0FzdC5jcmVhdGVDb21waWxlQ29udGV4dCh2aWV3TmFtZSwgZGJTZXJ2aWNlLnNlcnZpY2VJZCwgdGhpcy5saW5rZXIpO1xuXG4gICAgICAgICAgICBjb21waWxlQ29udGV4dC5tb2RlbFZhcnMuYWRkKHZpZXdJbmZvLmVudGl0eSk7XG5cbiAgICAgICAgICAgIGxldCBwYXJhbU1ldGE7XG5cbiAgICAgICAgICAgIGlmICh2aWV3SW5mby5wYXJhbXMpIHtcbiAgICAgICAgICAgICAgICBwYXJhbU1ldGEgPSB0aGlzLl9wcm9jZXNzUGFyYW1zKHZpZXdJbmZvLnBhcmFtcywgY29tcGlsZUNvbnRleHQpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBsZXQgdmlld01ldGEgPSB7XG4gICAgICAgICAgICAgICAgaXNMaXN0OiB2aWV3SW5mby5pc0xpc3QsXG4gICAgICAgICAgICAgICAgcGFyYW1zOiBwYXJhbU1ldGFcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIGxldCB2aWV3Qm9keVRvcG9JZCA9IE9vbFRvQXN0LmNyZWF0ZVRvcG9JZChjb21waWxlQ29udGV4dCwgJyR2aWV3Jyk7XG4gICAgICAgICAgICBPb2xUb0FzdC5kZXBlbmRzT24oY29tcGlsZUNvbnRleHQsIGNvbXBpbGVDb250ZXh0Lm1haW5TdGFydElkLCB2aWV3Qm9keVRvcG9JZCk7XG5cbiAgICAgICAgICAgIGxldCB2aWV3TW9kZWxlciA9IHJlcXVpcmUocGF0aC5yZXNvbHZlKF9fZGlybmFtZSwgJy4vZGFvL3ZpZXcnLCBkYlNlcnZpY2UuZGJUeXBlICsgJy5qcycpKTtcbiAgICAgICAgICAgIGNvbXBpbGVDb250ZXh0LmFzdE1hcFt2aWV3Qm9keVRvcG9JZF0gPSB2aWV3TW9kZWxlcihkYlNlcnZpY2UsIHZpZXdOYW1lLCB2aWV3SW5mbyk7XG4gICAgICAgICAgICBPb2xUb0FzdC5hZGRDb2RlQmxvY2soY29tcGlsZUNvbnRleHQsIHZpZXdCb2R5VG9wb0lkLCB7XG4gICAgICAgICAgICAgICAgdHlwZTogT29sVG9Bc3QuQVNUX0JMS19WSUVXX09QRVJBVElPTlxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGxldCByZXR1cm5Ub3BvSWQgPSBPb2xUb0FzdC5jcmVhdGVUb3BvSWQoY29tcGlsZUNvbnRleHQsICckcmV0dXJuOnZhbHVlJyk7XG4gICAgICAgICAgICBPb2xUb0FzdC5kZXBlbmRzT24oY29tcGlsZUNvbnRleHQsIHZpZXdCb2R5VG9wb0lkLCByZXR1cm5Ub3BvSWQpO1xuICAgICAgICAgICAgT29sVG9Bc3QuY29tcGlsZVJldHVybihyZXR1cm5Ub3BvSWQsIHtcbiAgICAgICAgICAgICAgICBcIm9vbFR5cGVcIjogXCJPYmplY3RSZWZlcmVuY2VcIixcbiAgICAgICAgICAgICAgICBcIm5hbWVcIjogXCJ2aWV3RGF0YVwiXG4gICAgICAgICAgICB9LCBjb21waWxlQ29udGV4dCk7XG5cbiAgICAgICAgICAgIGxldCBkZXBzID0gY29tcGlsZUNvbnRleHQudG9wb1NvcnQuc29ydCgpO1xuICAgICAgICAgICAgdGhpcy5saW5rZXIudmVyYm9zZSgnQWxsIGRlcGVuZGVuY2llczpcXG4nICsgSlNPTi5zdHJpbmdpZnkoZGVwcywgbnVsbCwgMikpO1xuXG4gICAgICAgICAgICBkZXBzID0gZGVwcy5maWx0ZXIoZGVwID0+IGNvbXBpbGVDb250ZXh0Lm1hcE9mVG9rZW5Ub01ldGEuaGFzKGRlcCkpO1xuICAgICAgICAgICAgdGhpcy5saW5rZXIudmVyYm9zZSgnQWxsIG5lY2Vzc2FyeSBzb3VyY2UgY29kZTpcXG4nICsgSlNPTi5zdHJpbmdpZnkoZGVwcywgbnVsbCwgMikpO1xuXG4gICAgICAgICAgICBsZXQgYXN0RG9Mb2FkTWFpbiA9IFtcbiAgICAgICAgICAgICAgICBKc0xhbmcuYXN0VmFyRGVjbGFyZSgnJG1ldGEnLCBKc0xhbmcuYXN0VmFyUmVmKCd0aGlzLm1ldGEnKSwgdHJ1ZSwgZmFsc2UsICdSZXRyaWV2aW5nIHRoZSBtZXRhIGRhdGEnKVxuICAgICAgICAgICAgXTtcblxuICAgICAgICAgICAgXy5lYWNoKGRlcHMsIGRlcCA9PiB7XG4gICAgICAgICAgICAgICAgbGV0IGFzdE1ldGEgPSBjb21waWxlQ29udGV4dC5tYXBPZlRva2VuVG9NZXRhLmdldChkZXApO1xuXG4gICAgICAgICAgICAgICAgbGV0IGFzdEJsb2NrID0gY29tcGlsZUNvbnRleHQuYXN0TWFwW2RlcF07XG4gICAgICAgICAgICAgICAgYXNzZXJ0OiBhc3RCbG9jaywgJ0VtcHR5IGFzdCBibG9jayc7XG5cbiAgICAgICAgICAgICAgICBpZiAoYXN0TWV0YS50eXBlID09PSAnTW9kaWZpZXJDYWxsJykge1xuICAgICAgICAgICAgICAgICAgICBsZXQgZmllbGROYW1lID0gZ2V0RmllbGROYW1lKGFzdE1ldGEudGFyZ2V0KTtcbiAgICAgICAgICAgICAgICAgICAgbGV0IGFzdENhY2hlID0gSnNMYW5nLmFzdEFzc2lnbihKc0xhbmcuYXN0VmFyUmVmKGFzdE1ldGEudGFyZ2V0KSwgYXN0QmxvY2ssIGBNb2RpZnlpbmcgJHtmaWVsZE5hbWV9YCk7XG4gICAgICAgICAgICAgICAgICAgIGFzdERvTG9hZE1haW4ucHVzaChhc3RDYWNoZSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBhc3REb0xvYWRNYWluID0gYXN0RG9Mb2FkTWFpbi5jb25jYXQoXy5jYXN0QXJyYXkoY29tcGlsZUNvbnRleHQuYXN0TWFwW2RlcF0pKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBpZiAoIV8uaXNFbXB0eShjb21waWxlQ29udGV4dC5tYXBPZkZ1bmN0b3JUb0ZpbGUpKSB7XG4gICAgICAgICAgICAgICAgXy5mb3JPd24oY29tcGlsZUNvbnRleHQubWFwT2ZGdW5jdG9yVG9GaWxlLCAoZmlsZU5hbWUsIGZ1bmN0aW9uTmFtZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBKc0xhbmcuYXN0UHVzaEluQm9keShhc3QsIEpzTGFuZy5hc3RSZXF1aXJlKGZ1bmN0aW9uTmFtZSwgJy4nICsgZmlsZU5hbWUpKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCFfLmlzRW1wdHkoY29tcGlsZUNvbnRleHQubmV3RnVuY3RvckZpbGVzKSkge1xuICAgICAgICAgICAgICAgIF8uZWFjaChjb21waWxlQ29udGV4dC5uZXdGdW5jdG9yRmlsZXMsIGVudHJ5ID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZ2VuZXJhdGVGdW5jdGlvblRlbXBsYXRlRmlsZShkYlNlcnZpY2UsIGVudHJ5KTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgSnNMYW5nLmFzdFB1c2hJbkJvZHkoYXN0LCBKc0xhbmcuYXN0Q2xhc3NEZWNsYXJlKGNhcGl0YWxpemVkLCAnVmlldycsIFtcbiAgICAgICAgICAgICAgICBKc0xhbmcuYXN0TWVtYmVyTWV0aG9kKCdfZG9Mb2FkJywgT2JqZWN0LmtleXMocGFyYW1NZXRhKSxcbiAgICAgICAgICAgICAgICAgICAgYXN0RG9Mb2FkTWFpbixcbiAgICAgICAgICAgICAgICAgICAgZmFsc2UsIHRydWUsIGZhbHNlLCAnUG9wdWxhdGUgdmlldyBkYXRhJ1xuICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgIF0sIGAke2NhcGl0YWxpemVkfSB2aWV3YCkpO1xuICAgICAgICAgICAgSnNMYW5nLmFzdFB1c2hJbkJvZHkoYXN0LCBKc0xhbmcuYXN0QXNzaWduKGNhcGl0YWxpemVkICsgJy5tZXRhJywgSnNMYW5nLmFzdFZhbHVlKHZpZXdNZXRhKSkpO1xuICAgICAgICAgICAgSnNMYW5nLmFzdFB1c2hJbkJvZHkoYXN0LCBKc0xhbmcuYXN0QXNzaWduKCdtb2R1bGUuZXhwb3J0cycsIEpzTGFuZy5hc3RWYXJSZWYoY2FwaXRhbGl6ZWQpKSk7XG5cbiAgICAgICAgICAgIGxldCBtb2RlbEZpbGVQYXRoID0gcGF0aC5yZXNvbHZlKHRoaXMub3V0cHV0UGF0aCwgZGJTZXJ2aWNlLmRiVHlwZSwgZGJTZXJ2aWNlLm5hbWUsICd2aWV3cycsIHZpZXdOYW1lICsgJy5qcycpO1xuICAgICAgICAgICAgZnMuZW5zdXJlRmlsZVN5bmMobW9kZWxGaWxlUGF0aCk7XG4gICAgICAgICAgICBmcy53cml0ZUZpbGVTeW5jKG1vZGVsRmlsZVBhdGggKyAnLmpzb24nLCBKU09OLnN0cmluZ2lmeShhc3QsIG51bGwsIDIpKTtcblxuICAgICAgICAgICAgRGFvTW9kZWxlci5fZXhwb3J0U291cmNlQ29kZShhc3QsIG1vZGVsRmlsZVBhdGgpO1xuXG4gICAgICAgICAgICB0aGlzLmxpbmtlci5sb2coJ2luZm8nLCAnR2VuZXJhdGVkIHZpZXcgbW9kZWw6ICcgKyBtb2RlbEZpbGVQYXRoKTtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICAqL1xufVxuXG5tb2R1bGUuZXhwb3J0cyA9IEdyYXBoUUxNb2RlbGVyOyJdfQ==
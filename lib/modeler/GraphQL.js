"use strict";

require("source-map-support/register");

const path = require('path');

const {
  _,
  fs,
  pascalCase,
  replaceAll,
  putIntoBucket
} = require('rk-utils');

const {
  toGraphQLType
} = require('./graphql/lang');

class GraphQLModeler {
  constructor(context, linker, connector) {
    this.linker = linker;
    this.outputPath = context.modelPath;
    this.manifestPath = context.manifestPath;
    this.connector = connector;
  }

  modeling_(schema) {
    this.linker.log('info', 'Generating graphql models for schema "' + schema.name + '"...');

    this._generateGraphQLModel(schema);
  }

  _generateEnumTypes(schema) {
    _.forOwn(schema.entities, (entity, entityInstanceName) => {
      _.forOwn(entity.fields, (field, fieldName) => {
        if (field.type === 'enum') {}
      });
    });
  }

  _generateGraphQLModel(schema) {
    const generated = new Set();
    const typeDefs = [];

    _.forOwn(schema.entities, (entity, entityInstanceName) => {
      let capitalized = pascalCase(entityInstanceName);

      let fields = _.map(entity.fields, (field, fieldName) => {
        if (fieldName === entity.key) {
          return `${fieldName}: ID!`;
        }

        const typeInfo = toGraphQLType(field);

        if (typeInfo.newType) {
          if (!generated.has(typeInfo.newType)) {
            generated.add(typeInfo.newType);

            switch (typeInfo.typeName) {
              case 'scalar':
                typeDefs.push(`scalar ${typeInfo.newType}`);
                break;

              case 'enum':
                typeDefs.push(`enum ${typeInfo.newType} {
    ${typeInfo.values.map(v => _.snakeCase(v).toUpperCase()).join('\n    ')}
}`);
                break;

              default:
                throw new Error(`Unsupported graphql type: ${typeInfo.newType}`);
            }
          }
        }

        return `${fieldName}: ${typeInfo.type}`;
      });

      if (_.isEmpty(!entity.associations)) {
        _.each(entity.associations, (assoc, anchor) => {
          const typeName = pascalCase(assoc.entity);

          if (assoc.list) {
            fields.push(`${anchor}_: [${typeName}!]`);
          } else {
            fields.push(`${anchor}_: ${typeName}`);
          }
        });
      }

      let classCode = `type ${capitalized} {
    ${fields.join('\n    ')}
}`;
      typeDefs.push(classCode);
    });

    let modelFilePath = path.resolve(this.manifestPath, 'graphql', schema.name + '.graphql');
    fs.ensureFileSync(modelFilePath);
    fs.writeFileSync(modelFilePath, typeDefs.join('\n\n'));
    this.linker.log('info', 'Generated graphql model: ' + modelFilePath);
  }

  _generateEntityManifest(schema) {
    let entities = Object.keys(schema.entities).sort().reduce((result, v) => {
      result[v] = {};
      return result;
    }, {});
    let outputFilePath = path.resolve(this.manifestPath, schema.name + '.manifest.json');
    fs.ensureFileSync(outputFilePath);
    fs.writeFileSync(outputFilePath, JSON.stringify(entities, null, 4));
    this.linker.log('info', 'Generated schema manifest: ' + outputFilePath);
  }

}

module.exports = GraphQLModeler;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9tb2RlbGVyL0dyYXBoUUwuanMiXSwibmFtZXMiOlsicGF0aCIsInJlcXVpcmUiLCJfIiwiZnMiLCJwYXNjYWxDYXNlIiwicmVwbGFjZUFsbCIsInB1dEludG9CdWNrZXQiLCJ0b0dyYXBoUUxUeXBlIiwiR3JhcGhRTE1vZGVsZXIiLCJjb25zdHJ1Y3RvciIsImNvbnRleHQiLCJsaW5rZXIiLCJjb25uZWN0b3IiLCJvdXRwdXRQYXRoIiwibW9kZWxQYXRoIiwibWFuaWZlc3RQYXRoIiwibW9kZWxpbmdfIiwic2NoZW1hIiwibG9nIiwibmFtZSIsIl9nZW5lcmF0ZUdyYXBoUUxNb2RlbCIsIl9nZW5lcmF0ZUVudW1UeXBlcyIsImZvck93biIsImVudGl0aWVzIiwiZW50aXR5IiwiZW50aXR5SW5zdGFuY2VOYW1lIiwiZmllbGRzIiwiZmllbGQiLCJmaWVsZE5hbWUiLCJ0eXBlIiwiZ2VuZXJhdGVkIiwiU2V0IiwidHlwZURlZnMiLCJjYXBpdGFsaXplZCIsIm1hcCIsImtleSIsInR5cGVJbmZvIiwibmV3VHlwZSIsImhhcyIsImFkZCIsInR5cGVOYW1lIiwicHVzaCIsInZhbHVlcyIsInYiLCJzbmFrZUNhc2UiLCJ0b1VwcGVyQ2FzZSIsImpvaW4iLCJFcnJvciIsImlzRW1wdHkiLCJhc3NvY2lhdGlvbnMiLCJlYWNoIiwiYXNzb2MiLCJhbmNob3IiLCJsaXN0IiwiY2xhc3NDb2RlIiwibW9kZWxGaWxlUGF0aCIsInJlc29sdmUiLCJlbnN1cmVGaWxlU3luYyIsIndyaXRlRmlsZVN5bmMiLCJfZ2VuZXJhdGVFbnRpdHlNYW5pZmVzdCIsIk9iamVjdCIsImtleXMiLCJzb3J0IiwicmVkdWNlIiwicmVzdWx0Iiwib3V0cHV0RmlsZVBhdGgiLCJKU09OIiwic3RyaW5naWZ5IiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7QUFFQSxNQUFNQSxJQUFJLEdBQUdDLE9BQU8sQ0FBQyxNQUFELENBQXBCOztBQUNBLE1BQU07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QWMsTUFBZCxDQUFoQztBQUVBLFNBQUtuQyxNQUFMLENBQVlPLEdBQVosQ0FBZ0IsTUFBaEIsRUFBd0IsOEJBQThCcUMsYUFBdEQ7QUFDSDs7QUFFREksRUFBQUEsdUJBQXVCLENBQUMxQyxNQUFELEVBQVM7QUFDNUIsUUFBSU0sUUFBUSxHQUFHcUMsTUFBTSxDQUFDQyxJQUFQLENBQVk1QyxNQUFNLENBQUNNLFFBQW5CLEVBQTZCdUMsSUFBN0IsR0FBb0NDLE1BQXBDLENBQTJDLENBQUNDLE1BQUQsRUFBU3JCLENBQVQsS0FBZTtBQUFFcUIsTUFBQUEsTUFBTSxDQUFDckIsQ0FBRCxDQUFOLEdBQVksRUFBWjtBQUFnQixhQUFPcUIsTUFBUDtBQUFnQixLQUE1RixFQUE4RixFQUE5RixDQUFmO0FBb0RBLFFBQUlDLGNBQWMsR0FBR2pFLElBQUksQ0FBQ3dELE9BQUwsQ0FBYSxLQUFLekMsWUFBbEIsRUFBZ0NFLE1BQU0sQ0FBQ0UsSUFBUCxHQUFjLGdCQUE5QyxDQUFyQjtBQUNBaEIsSUFBQUEsRUFBRSxDQUFDc0QsY0FBSCxDQUFrQlEsY0FBbEI7QUFDQTlELElBQUFBLEVBQUUsQ0FBQ3VELGFBQUgsQ0FBaUJPLGNBQWpCLEVBQWlDQyxJQUFJLENBQUNDLFNBQUwsQ0FBZTVDLFFBQWYsRUFBeUIsSUFBekIsRUFBK0IsQ0FBL0IsQ0FBakM7QUFFQSxTQUFLWixNQUFMLENBQVlPLEdBQVosQ0FBZ0IsTUFBaEIsRUFBd0IsZ0NBQWdDK0MsY0FBeEQ7QUFDSDs7QUFqTGdCOztBQTJSckJHLE1BQU0sQ0FBQ0MsT0FBUCxHQUFpQjdELGNBQWpCIiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5cbmNvbnN0IHBhdGggPSByZXF1aXJlKCdwYXRoJyk7XG5jb25zdCB7IF8sIGZzLCBwYXNjYWxDYXNlLCByZXBsYWNlQWxsLCBwdXRJbnRvQnVja2V0IH0gID0gcmVxdWlyZSgncmstdXRpbHMnKTtcblxuY29uc3QgeyB0b0dyYXBoUUxUeXBlIH0gPSByZXF1aXJlKCcuL2dyYXBocWwvbGFuZycpO1xuXG4vKipcbiAqIEdyYXBoUUwgc2NoZW1hcyBtb2RlbGVyLlxuICogQGNsYXNzXG4gKi9cbmNsYXNzIEdyYXBoUUxNb2RlbGVyIHtcbiAgICAvKiogICAgIFxuICAgICAqIEBwYXJhbSB7b2JqZWN0fSBjb250ZXh0ICAgXG4gICAgICogQHByb3BlcnR5IHtHZW1sTGlua2VyfSBjb250ZXh0LmxpbmtlciAtIEdlbWwgbGlua2VyXG4gICAgICogQHByb3BlcnR5IHtvYmplY3R9IGNvbnRleHQubW9kZWxQYXRoIC0gR2VuZXJhdGVkIG1vZGVsIG91dHB1dCBwYXRoXG4gICAgICogQHByb3BlcnR5IHtvYmplY3R9IGNvbnRleHQubWFuaWZlc3RQYXRoIC0gRW50aXRpZXMgbWFuaWZlc3Qgb3V0cHV0IHBhdGhcbiAgICAgKiBAcGFyYW0ge0Nvbm5lY3Rvcn0gY29ubmVjdG9yICAgICAgXG4gICAgICovXG4gICAgY29uc3RydWN0b3IoY29udGV4dCwgbGlua2VyLCBjb25uZWN0b3IpIHsgICAgICAgXG4gICAgICAgIHRoaXMubGlua2VyID0gbGlua2VyO1xuICAgICAgICB0aGlzLm91dHB1dFBhdGggPSBjb250ZXh0Lm1vZGVsUGF0aDtcbiAgICAgICAgdGhpcy5tYW5pZmVzdFBhdGggPSBjb250ZXh0Lm1hbmlmZXN0UGF0aDtcblxuICAgICAgICB0aGlzLmNvbm5lY3RvciA9IGNvbm5lY3RvcjsgICAgICAgIFxuICAgIH1cblxuICAgIG1vZGVsaW5nXyhzY2hlbWEpIHtcbiAgICAgICAgdGhpcy5saW5rZXIubG9nKCdpbmZvJywgJ0dlbmVyYXRpbmcgZ3JhcGhxbCBtb2RlbHMgZm9yIHNjaGVtYSBcIicgKyBzY2hlbWEubmFtZSArICdcIi4uLicpO1xuXG4gICAgICAgIC8vdGhpcy5fZ2VuZXJhdGVTY2hlbWFNb2RlbChzY2hlbWEpOyAgICAgICAgXG4gICAgICAgIHRoaXMuX2dlbmVyYXRlR3JhcGhRTE1vZGVsKHNjaGVtYSk7XG4gICAgfVxuXG4gICAgLypcbiAgICBfZ2VuZXJhdGVTY2hlbWFNb2RlbChzY2hlbWEpIHtcbiAgICAgICAgbGV0IGNhcGl0YWxpemVkID0gcGFzY2FsQ2FzZShzY2hlbWEubmFtZSk7XG5cbiAgICAgICAgbGV0IGxvY2FscyA9IHtcbiAgICAgICAgICAgIGRyaXZlcjogdGhpcy5jb25uZWN0b3IuZHJpdmVyLFxuICAgICAgICAgICAgY2xhc3NOYW1lOiBjYXBpdGFsaXplZCxcbiAgICAgICAgICAgIHNjaGVtYU5hbWU6IHNjaGVtYS5uYW1lLFxuICAgICAgICAgICAgZW50aXRpZXM6IEpTT04uc3RyaW5naWZ5KE9iamVjdC5rZXlzKHNjaGVtYS5lbnRpdGllcykpXG4gICAgICAgIH07XG5cbiAgICAgICAgbGV0IGNsYXNzVGVtcGxhdGUgPSBwYXRoLnJlc29sdmUoX19kaXJuYW1lLCAnZGF0YWJhc2UnLCB0aGlzLmNvbm5lY3Rvci5kcml2ZXIsICdEYXRhYmFzZS5qcy5zd2lnJyk7XG4gICAgICAgIGxldCBjbGFzc0NvZGUgPSBzd2lnLnJlbmRlckZpbGUoY2xhc3NUZW1wbGF0ZSwgbG9jYWxzKTtcblxuICAgICAgICBsZXQgbW9kZWxGaWxlUGF0aCA9IHBhdGgucmVzb2x2ZSh0aGlzLm91dHB1dFBhdGgsIGNhcGl0YWxpemVkICsgJy5qcycpO1xuICAgICAgICBmcy5lbnN1cmVGaWxlU3luYyhtb2RlbEZpbGVQYXRoKTtcbiAgICAgICAgZnMud3JpdGVGaWxlU3luYyhtb2RlbEZpbGVQYXRoLCBjbGFzc0NvZGUpO1xuXG4gICAgICAgIHRoaXMubGlua2VyLmxvZygnaW5mbycsICdHZW5lcmF0ZWQgZGF0YWJhc2UgbW9kZWw6ICcgKyBtb2RlbEZpbGVQYXRoKTtcbiAgICB9Ki9cblxuICAgIF9nZW5lcmF0ZUVudW1UeXBlcyhzY2hlbWEpIHtcbiAgICAgICAgXy5mb3JPd24oc2NoZW1hLmVudGl0aWVzLCAoZW50aXR5LCBlbnRpdHlJbnN0YW5jZU5hbWUpID0+IHtcbiAgICAgICAgICAgIF8uZm9yT3duKGVudGl0eS5maWVsZHMsIChmaWVsZCwgZmllbGROYW1lKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGZpZWxkLnR5cGUgPT09ICdlbnVtJykge1xuXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIF9nZW5lcmF0ZUdyYXBoUUxNb2RlbChzY2hlbWEpIHtcbiAgICAgICAgY29uc3QgZ2VuZXJhdGVkID0gbmV3IFNldCgpO1xuXG4gICAgICAgIGNvbnN0IHR5cGVEZWZzID0gW107XG5cbiAgICAgICAgXy5mb3JPd24oc2NoZW1hLmVudGl0aWVzLCAoZW50aXR5LCBlbnRpdHlJbnN0YW5jZU5hbWUpID0+IHsgICAgICAgICAgICBcbiAgICAgICAgICAgIGxldCBjYXBpdGFsaXplZCA9IHBhc2NhbENhc2UoZW50aXR5SW5zdGFuY2VOYW1lKTsgICAgICAgICAgICAgICAgICBcblxuICAgICAgICAgICAgbGV0IGZpZWxkcyA9IF8ubWFwKGVudGl0eS5maWVsZHMsIChmaWVsZCwgZmllbGROYW1lKSA9PiB7ICBcbiAgICAgICAgICAgICAgICBpZiAoZmllbGROYW1lID09PSBlbnRpdHkua2V5KSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBgJHtmaWVsZE5hbWV9OiBJRCFgO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGNvbnN0IHR5cGVJbmZvID0gdG9HcmFwaFFMVHlwZShmaWVsZCk7ICAgIFxuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIGlmICh0eXBlSW5mby5uZXdUeXBlKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghZ2VuZXJhdGVkLmhhcyh0eXBlSW5mby5uZXdUeXBlKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZ2VuZXJhdGVkLmFkZCh0eXBlSW5mby5uZXdUeXBlKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoICh0eXBlSW5mby50eXBlTmFtZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ3NjYWxhcic6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGVEZWZzLnB1c2goYHNjYWxhciAke3R5cGVJbmZvLm5ld1R5cGV9YCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnZW51bSc6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGVEZWZzLnB1c2goYGVudW0gJHt0eXBlSW5mby5uZXdUeXBlfSB7XG4gICAgJHt0eXBlSW5mby52YWx1ZXMubWFwKHYgPT4gXy5zbmFrZUNhc2UodikudG9VcHBlckNhc2UoKSkuam9pbignXFxuICAgICcpfVxufWApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgVW5zdXBwb3J0ZWQgZ3JhcGhxbCB0eXBlOiAke3R5cGVJbmZvLm5ld1R5cGV9YCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0gXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIHJldHVybiBgJHtmaWVsZE5hbWV9OiAke3R5cGVJbmZvLnR5cGV9YDtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBpZiAoXy5pc0VtcHR5KCFlbnRpdHkuYXNzb2NpYXRpb25zKSkge1xuICAgICAgICAgICAgICAgIF8uZWFjaChlbnRpdHkuYXNzb2NpYXRpb25zLCAoYXNzb2MsIGFuY2hvcikgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCB0eXBlTmFtZSA9IHBhc2NhbENhc2UoYXNzb2MuZW50aXR5KTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoYXNzb2MubGlzdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZmllbGRzLnB1c2goYCR7YW5jaG9yfV86IFske3R5cGVOYW1lfSFdYCk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmaWVsZHMucHVzaChgJHthbmNob3J9XzogJHt0eXBlTmFtZX1gKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBsZXQgY2xhc3NDb2RlID0gYHR5cGUgJHtjYXBpdGFsaXplZH0ge1xuICAgICR7ZmllbGRzLmpvaW4oJ1xcbiAgICAnKX1cbn1gOyAgICAgICAgICAgICAgICAgICAgICAgICBcblxuICAgICAgICAgICAgdHlwZURlZnMucHVzaChjbGFzc0NvZGUpOyAgICAgICAgICAgIFxuICAgICAgICB9KTtcblxuICAgICAgICBsZXQgbW9kZWxGaWxlUGF0aCA9IHBhdGgucmVzb2x2ZSh0aGlzLm1hbmlmZXN0UGF0aCwgJ2dyYXBocWwnLCBzY2hlbWEubmFtZSArICcuZ3JhcGhxbCcpO1xuICAgICAgICBmcy5lbnN1cmVGaWxlU3luYyhtb2RlbEZpbGVQYXRoKTtcbiAgICAgICAgZnMud3JpdGVGaWxlU3luYyhtb2RlbEZpbGVQYXRoLCB0eXBlRGVmcy5qb2luKCdcXG5cXG4nKSk7XG5cbiAgICAgICAgdGhpcy5saW5rZXIubG9nKCdpbmZvJywgJ0dlbmVyYXRlZCBncmFwaHFsIG1vZGVsOiAnICsgbW9kZWxGaWxlUGF0aCk7XG4gICAgfVxuXG4gICAgX2dlbmVyYXRlRW50aXR5TWFuaWZlc3Qoc2NoZW1hKSB7XG4gICAgICAgIGxldCBlbnRpdGllcyA9IE9iamVjdC5rZXlzKHNjaGVtYS5lbnRpdGllcykuc29ydCgpLnJlZHVjZSgocmVzdWx0LCB2KSA9PiB7IHJlc3VsdFt2XSA9IHt9OyByZXR1cm4gcmVzdWx0OyB9LCB7fSk7XG4gICAgICAgIC8qXG4gICAgICAgIGxldCBtYW5pZmVzdCA9IHt9O1xuXG4gICAgICAgIF8uZWFjaChzY2hlbWEuZW50aXRpZXMsIChlbnRpdHksIGVudGl0eU5hbWUpID0+IHtcbiAgICAgICAgICAgIGlmIChlbnRpdHkuaW5mby5yZXN0ZnVsKSB7XG4gICAgICAgICAgICAgICAgXy5lYWNoKGVudGl0eS5pbmZvLnJlc3RmdWwsICh7IHR5cGUsIG1ldGhvZHMgfSwgcmVsYXRpdmVVcmkpID0+IHsgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICBsZXQgYXBpSW5mbyA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGUsXG4gICAgICAgICAgICAgICAgICAgICAgICBtZXRob2RzOiB7fSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGUgPT09ICdlbnRpdHknKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhcGlJbmZvLmVudGl0eSA9IGVudGl0eU5hbWU7XG4gICAgICAgICAgICAgICAgICAgICAgICBhcGlJbmZvLmRpc3BsYXlOYW1lID0gZW50aXR5LmRpc3BsYXlOYW1lO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZW50aXR5LmNvbW1lbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcGlJbmZvLmRlc2NyaXB0aW9uID0gZW50aXR5LmNvbW1lbnQ7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBfLmVhY2gobWV0aG9kcywgKG1ldGEsIG1ldGhvZE5hbWUpID0+IHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChtZXRob2ROYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnY3JlYXRlJzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBpSW5mby5tZXRob2RzWydwb3N0OicgKyByZWxhdGl2ZVVyaV0gPSBtZXRhO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnZmluZE9uZSc6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdmaW5lQWxsJzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ3VwZGF0ZU9uZSc6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICd1cGRhdGVNYW55JzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ2RlbGV0ZU9uZSc6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdkZWxldGVNYW55JzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgICovXG4gICAgICAgIGxldCBvdXRwdXRGaWxlUGF0aCA9IHBhdGgucmVzb2x2ZSh0aGlzLm1hbmlmZXN0UGF0aCwgc2NoZW1hLm5hbWUgKyAnLm1hbmlmZXN0Lmpzb24nKTtcbiAgICAgICAgZnMuZW5zdXJlRmlsZVN5bmMob3V0cHV0RmlsZVBhdGgpO1xuICAgICAgICBmcy53cml0ZUZpbGVTeW5jKG91dHB1dEZpbGVQYXRoLCBKU09OLnN0cmluZ2lmeShlbnRpdGllcywgbnVsbCwgNCkpO1xuXG4gICAgICAgIHRoaXMubGlua2VyLmxvZygnaW5mbycsICdHZW5lcmF0ZWQgc2NoZW1hIG1hbmlmZXN0OiAnICsgb3V0cHV0RmlsZVBhdGgpO1xuICAgIH1cblxuICAgIC8qXG4gICAgX2dlbmVyYXRlVmlld01vZGVsKHNjaGVtYSwgZGJTZXJ2aWNlKSB7ICAgICAgICBcbiAgICAgICAgXy5mb3JPd24oc2NoZW1hLnZpZXdzLCAodmlld0luZm8sIHZpZXdOYW1lKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmxpbmtlci5pbmZvKCdCdWlsZGluZyB2aWV3OiAnICsgdmlld05hbWUpO1xuXG4gICAgICAgICAgICBsZXQgY2FwaXRhbGl6ZWQgPSBfLnVwcGVyRmlyc3Qodmlld05hbWUpO1xuXG4gICAgICAgICAgICBsZXQgYXN0ID0gSnNMYW5nLmFzdFByb2dyYW0oKTtcblxuICAgICAgICAgICAgSnNMYW5nLmFzdFB1c2hJbkJvZHkoYXN0LCBKc0xhbmcuYXN0UmVxdWlyZSgnTW93YScsICdtb3dhJykpO1xuICAgICAgICAgICAgSnNMYW5nLmFzdFB1c2hJbkJvZHkoYXN0LCBKc0xhbmcuYXN0VmFyRGVjbGFyZSgnVXRpbCcsIEpzTGFuZy5hc3RWYXJSZWYoJ01vd2EuVXRpbCcpLCB0cnVlKSk7XG4gICAgICAgICAgICBKc0xhbmcuYXN0UHVzaEluQm9keShhc3QsIEpzTGFuZy5hc3RWYXJEZWNsYXJlKCdfJywgSnNMYW5nLmFzdFZhclJlZignVXRpbC5fJyksIHRydWUpKTtcbiAgICAgICAgICAgIEpzTGFuZy5hc3RQdXNoSW5Cb2R5KGFzdCwgSnNMYW5nLmFzdFJlcXVpcmUoJ1ZpZXcnLCAnbW93YS9saWIvb29sb25nL3J1bnRpbWUvdmlldycpKTtcblxuICAgICAgICAgICAgbGV0IGNvbXBpbGVDb250ZXh0ID0gT29sVG9Bc3QuY3JlYXRlQ29tcGlsZUNvbnRleHQodmlld05hbWUsIGRiU2VydmljZS5zZXJ2aWNlSWQsIHRoaXMubGlua2VyKTtcblxuICAgICAgICAgICAgY29tcGlsZUNvbnRleHQubW9kZWxWYXJzLmFkZCh2aWV3SW5mby5lbnRpdHkpO1xuXG4gICAgICAgICAgICBsZXQgcGFyYW1NZXRhO1xuXG4gICAgICAgICAgICBpZiAodmlld0luZm8ucGFyYW1zKSB7XG4gICAgICAgICAgICAgICAgcGFyYW1NZXRhID0gdGhpcy5fcHJvY2Vzc1BhcmFtcyh2aWV3SW5mby5wYXJhbXMsIGNvbXBpbGVDb250ZXh0KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgbGV0IHZpZXdNZXRhID0ge1xuICAgICAgICAgICAgICAgIGlzTGlzdDogdmlld0luZm8uaXNMaXN0LFxuICAgICAgICAgICAgICAgIHBhcmFtczogcGFyYW1NZXRhXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBsZXQgdmlld0JvZHlUb3BvSWQgPSBPb2xUb0FzdC5jcmVhdGVUb3BvSWQoY29tcGlsZUNvbnRleHQsICckdmlldycpO1xuICAgICAgICAgICAgT29sVG9Bc3QuZGVwZW5kc09uKGNvbXBpbGVDb250ZXh0LCBjb21waWxlQ29udGV4dC5tYWluU3RhcnRJZCwgdmlld0JvZHlUb3BvSWQpO1xuXG4gICAgICAgICAgICBsZXQgdmlld01vZGVsZXIgPSByZXF1aXJlKHBhdGgucmVzb2x2ZShfX2Rpcm5hbWUsICcuL2Rhby92aWV3JywgZGJTZXJ2aWNlLmRiVHlwZSArICcuanMnKSk7XG4gICAgICAgICAgICBjb21waWxlQ29udGV4dC5hc3RNYXBbdmlld0JvZHlUb3BvSWRdID0gdmlld01vZGVsZXIoZGJTZXJ2aWNlLCB2aWV3TmFtZSwgdmlld0luZm8pO1xuICAgICAgICAgICAgT29sVG9Bc3QuYWRkQ29kZUJsb2NrKGNvbXBpbGVDb250ZXh0LCB2aWV3Qm9keVRvcG9JZCwge1xuICAgICAgICAgICAgICAgIHR5cGU6IE9vbFRvQXN0LkFTVF9CTEtfVklFV19PUEVSQVRJT05cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBsZXQgcmV0dXJuVG9wb0lkID0gT29sVG9Bc3QuY3JlYXRlVG9wb0lkKGNvbXBpbGVDb250ZXh0LCAnJHJldHVybjp2YWx1ZScpO1xuICAgICAgICAgICAgT29sVG9Bc3QuZGVwZW5kc09uKGNvbXBpbGVDb250ZXh0LCB2aWV3Qm9keVRvcG9JZCwgcmV0dXJuVG9wb0lkKTtcbiAgICAgICAgICAgIE9vbFRvQXN0LmNvbXBpbGVSZXR1cm4ocmV0dXJuVG9wb0lkLCB7XG4gICAgICAgICAgICAgICAgXCJvb2xUeXBlXCI6IFwiT2JqZWN0UmVmZXJlbmNlXCIsXG4gICAgICAgICAgICAgICAgXCJuYW1lXCI6IFwidmlld0RhdGFcIlxuICAgICAgICAgICAgfSwgY29tcGlsZUNvbnRleHQpO1xuXG4gICAgICAgICAgICBsZXQgZGVwcyA9IGNvbXBpbGVDb250ZXh0LnRvcG9Tb3J0LnNvcnQoKTtcbiAgICAgICAgICAgIHRoaXMubGlua2VyLnZlcmJvc2UoJ0FsbCBkZXBlbmRlbmNpZXM6XFxuJyArIEpTT04uc3RyaW5naWZ5KGRlcHMsIG51bGwsIDIpKTtcblxuICAgICAgICAgICAgZGVwcyA9IGRlcHMuZmlsdGVyKGRlcCA9PiBjb21waWxlQ29udGV4dC5tYXBPZlRva2VuVG9NZXRhLmhhcyhkZXApKTtcbiAgICAgICAgICAgIHRoaXMubGlua2VyLnZlcmJvc2UoJ0FsbCBuZWNlc3Nhcnkgc291cmNlIGNvZGU6XFxuJyArIEpTT04uc3RyaW5naWZ5KGRlcHMsIG51bGwsIDIpKTtcblxuICAgICAgICAgICAgbGV0IGFzdERvTG9hZE1haW4gPSBbXG4gICAgICAgICAgICAgICAgSnNMYW5nLmFzdFZhckRlY2xhcmUoJyRtZXRhJywgSnNMYW5nLmFzdFZhclJlZigndGhpcy5tZXRhJyksIHRydWUsIGZhbHNlLCAnUmV0cmlldmluZyB0aGUgbWV0YSBkYXRhJylcbiAgICAgICAgICAgIF07XG5cbiAgICAgICAgICAgIF8uZWFjaChkZXBzLCBkZXAgPT4ge1xuICAgICAgICAgICAgICAgIGxldCBhc3RNZXRhID0gY29tcGlsZUNvbnRleHQubWFwT2ZUb2tlblRvTWV0YS5nZXQoZGVwKTtcblxuICAgICAgICAgICAgICAgIGxldCBhc3RCbG9jayA9IGNvbXBpbGVDb250ZXh0LmFzdE1hcFtkZXBdO1xuICAgICAgICAgICAgICAgIGFzc2VydDogYXN0QmxvY2ssICdFbXB0eSBhc3QgYmxvY2snO1xuXG4gICAgICAgICAgICAgICAgaWYgKGFzdE1ldGEudHlwZSA9PT0gJ01vZGlmaWVyQ2FsbCcpIHtcbiAgICAgICAgICAgICAgICAgICAgbGV0IGZpZWxkTmFtZSA9IGdldEZpZWxkTmFtZShhc3RNZXRhLnRhcmdldCk7XG4gICAgICAgICAgICAgICAgICAgIGxldCBhc3RDYWNoZSA9IEpzTGFuZy5hc3RBc3NpZ24oSnNMYW5nLmFzdFZhclJlZihhc3RNZXRhLnRhcmdldCksIGFzdEJsb2NrLCBgTW9kaWZ5aW5nICR7ZmllbGROYW1lfWApO1xuICAgICAgICAgICAgICAgICAgICBhc3REb0xvYWRNYWluLnB1c2goYXN0Q2FjaGUpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgYXN0RG9Mb2FkTWFpbiA9IGFzdERvTG9hZE1haW4uY29uY2F0KF8uY2FzdEFycmF5KGNvbXBpbGVDb250ZXh0LmFzdE1hcFtkZXBdKSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaWYgKCFfLmlzRW1wdHkoY29tcGlsZUNvbnRleHQubWFwT2ZGdW5jdG9yVG9GaWxlKSkge1xuICAgICAgICAgICAgICAgIF8uZm9yT3duKGNvbXBpbGVDb250ZXh0Lm1hcE9mRnVuY3RvclRvRmlsZSwgKGZpbGVOYW1lLCBmdW5jdGlvbk5hbWUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgSnNMYW5nLmFzdFB1c2hJbkJvZHkoYXN0LCBKc0xhbmcuYXN0UmVxdWlyZShmdW5jdGlvbk5hbWUsICcuJyArIGZpbGVOYW1lKSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICghXy5pc0VtcHR5KGNvbXBpbGVDb250ZXh0Lm5ld0Z1bmN0b3JGaWxlcykpIHtcbiAgICAgICAgICAgICAgICBfLmVhY2goY29tcGlsZUNvbnRleHQubmV3RnVuY3RvckZpbGVzLCBlbnRyeSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2dlbmVyYXRlRnVuY3Rpb25UZW1wbGF0ZUZpbGUoZGJTZXJ2aWNlLCBlbnRyeSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIEpzTGFuZy5hc3RQdXNoSW5Cb2R5KGFzdCwgSnNMYW5nLmFzdENsYXNzRGVjbGFyZShjYXBpdGFsaXplZCwgJ1ZpZXcnLCBbXG4gICAgICAgICAgICAgICAgSnNMYW5nLmFzdE1lbWJlck1ldGhvZCgnX2RvTG9hZCcsIE9iamVjdC5rZXlzKHBhcmFtTWV0YSksXG4gICAgICAgICAgICAgICAgICAgIGFzdERvTG9hZE1haW4sXG4gICAgICAgICAgICAgICAgICAgIGZhbHNlLCB0cnVlLCBmYWxzZSwgJ1BvcHVsYXRlIHZpZXcgZGF0YSdcbiAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICBdLCBgJHtjYXBpdGFsaXplZH0gdmlld2ApKTtcbiAgICAgICAgICAgIEpzTGFuZy5hc3RQdXNoSW5Cb2R5KGFzdCwgSnNMYW5nLmFzdEFzc2lnbihjYXBpdGFsaXplZCArICcubWV0YScsIEpzTGFuZy5hc3RWYWx1ZSh2aWV3TWV0YSkpKTtcbiAgICAgICAgICAgIEpzTGFuZy5hc3RQdXNoSW5Cb2R5KGFzdCwgSnNMYW5nLmFzdEFzc2lnbignbW9kdWxlLmV4cG9ydHMnLCBKc0xhbmcuYXN0VmFyUmVmKGNhcGl0YWxpemVkKSkpO1xuXG4gICAgICAgICAgICBsZXQgbW9kZWxGaWxlUGF0aCA9IHBhdGgucmVzb2x2ZSh0aGlzLm91dHB1dFBhdGgsIGRiU2VydmljZS5kYlR5cGUsIGRiU2VydmljZS5uYW1lLCAndmlld3MnLCB2aWV3TmFtZSArICcuanMnKTtcbiAgICAgICAgICAgIGZzLmVuc3VyZUZpbGVTeW5jKG1vZGVsRmlsZVBhdGgpO1xuICAgICAgICAgICAgZnMud3JpdGVGaWxlU3luYyhtb2RlbEZpbGVQYXRoICsgJy5qc29uJywgSlNPTi5zdHJpbmdpZnkoYXN0LCBudWxsLCAyKSk7XG5cbiAgICAgICAgICAgIERhb01vZGVsZXIuX2V4cG9ydFNvdXJjZUNvZGUoYXN0LCBtb2RlbEZpbGVQYXRoKTtcblxuICAgICAgICAgICAgdGhpcy5saW5rZXIubG9nKCdpbmZvJywgJ0dlbmVyYXRlZCB2aWV3IG1vZGVsOiAnICsgbW9kZWxGaWxlUGF0aCk7XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgKi9cbn1cblxubW9kdWxlLmV4cG9ydHMgPSBHcmFwaFFMTW9kZWxlcjsiXX0=
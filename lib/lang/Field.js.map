{"version":3,"sources":["../../src/lang/Field.js"],"names":["_","require","generateDisplayName","deepCloneField","Clonable","fieldNaming","Types","RESERVED_KEYS","Set","Field","constructor","name","info","link","assert","Builtin","has","type","typeObject","forOwn","value","key","qualifiers","includes","Error","Array","isArray","modifiers","find","mod","oolType","hasActivator","displayName","linked","hasSameType","targetField","isEqual","toJSON","clone","field","Object","assign","omit","toPlainObject","module","exports"],"mappings":"AAAA;;;;AAEA,MAAM;AAAEA,EAAAA;AAAF,IAAQC,OAAO,CAAC,YAAD,CAArB;;AACA,MAAM;AAAEC,EAAAA,mBAAF;AAAuBC,EAAAA,cAAvB;AAAuCC,EAAAA,QAAvC;AAAiDC,EAAAA;AAAjD,IAAiEJ,OAAO,CAAC,aAAD,CAA9E;;AACA,MAAM;AAAEK,EAAAA;AAAF,IAAYL,OAAO,CAAC,YAAD,CAAzB;;AACA,MAAMM,aAAa,GAAG,IAAIC,GAAJ,CAAQ,CAAC,MAAD,EAAS,MAAT,EAAiB,WAAjB,EAA8B,UAA9B,EAA0C,QAA1C,CAAR,CAAtB;;AAMA,MAAMC,KAAN,SAAoBL,QAApB,CAA6B;AAKzBM,EAAAA,WAAW,CAACC,IAAD,EAAOC,IAAP,EAAa;AACpB;AAEA,SAAKD,IAAL,GAAYN,WAAW,CAACM,IAAD,CAAvB;AAMA,SAAKC,IAAL,GAAYA,IAAZ;AACH;;AAKDC,EAAAA,IAAI,GAAG;AACHC,IAAAA,MAAM,EAAER,KAAK,CAACS,OAAN,CAAcC,GAAd,CAAkB,KAAKJ,IAAL,CAAUK,IAA5B;;AACR,QAAIC,UAAU,GAAGZ,KAAK,CAAC,KAAKM,IAAL,CAAUK,IAAX,CAAtB;;AAEAjB,IAAAA,CAAC,CAACmB,MAAF,CAAS,KAAKP,IAAd,EAAoB,CAACQ,KAAD,EAAQC,GAAR,KAAgB;AAChC,UAAId,aAAa,CAACS,GAAd,CAAkBK,GAAlB,CAAJ,EAA4B;AACxB,aAAKA,GAAL,IAAYD,KAAZ;AACA;AACH;;AAED,UAAI,CAACF,UAAU,CAACI,UAAX,CAAsBC,QAAtB,CAA+BF,GAA/B,CAAL,EAA0C;AACtC,cAAM,IAAIG,KAAJ,CAAW,gCAA+BH,GAAI,eAAc,KAAKT,IAAL,CAAUK,IAAK,eAAc,KAAKN,IAAK,IAAnG,CAAN;AACH;;AAED,WAAKU,GAAL,IAAYI,KAAK,CAACC,OAAN,CAAcN,KAAd,IAAuBA,KAAK,CAAC,CAAD,CAA5B,GAAkCA,KAA9C;AACH,KAXD;;AAaA,QAAI,KAAKR,IAAL,CAAUe,SAAV,IAAuB3B,CAAC,CAAC4B,IAAF,CAAO,KAAKhB,IAAL,CAAUe,SAAjB,EAA4BE,GAAG,IAAIA,GAAG,CAACC,OAAJ,KAAgB,WAAnD,CAA3B,EAA4F;AACxF,WAAKC,YAAL,GAAoB,IAApB;AACH;;AAMD,SAAKC,WAAL,GAAmB9B,mBAAmB,CAAC,KAAKS,IAAN,CAAtC;AAEAR,IAAAA,cAAc,CAAC,KAAKS,IAAN,EAAY,IAAZ,EAAkB,WAAlB,CAAd;AAEA,SAAKqB,MAAL,GAAc,IAAd;AACH;;AAEDC,EAAAA,WAAW,CAACC,WAAD,EAAc;AACrB,WAAOnC,CAAC,CAACoC,OAAF,CAAU,KAAKC,MAAL,EAAV,EAAyBF,WAAzB,CAAP;AACH;;AAMDG,EAAAA,KAAK,GAAG;AACJ,UAAMA,KAAN;AAEA,QAAIC,KAAK,GAAG,IAAI9B,KAAJ,CAAU,KAAKE,IAAf,EAAqB,KAAKC,IAA1B,CAAZ;AACA4B,IAAAA,MAAM,CAACC,MAAP,CAAcF,KAAd,EAAqB,KAAKF,MAAL,EAArB;AACAE,IAAAA,KAAK,CAACN,MAAN,GAAe,IAAf;AAEA,WAAOM,KAAP;AACH;;AAMDF,EAAAA,MAAM,GAAG;AACL,WAAOrC,CAAC,CAAC0C,IAAF,CAAO1C,CAAC,CAAC2C,aAAF,CAAgB,IAAhB,CAAP,EAA8B,CAAE,MAAF,EAAU,QAAV,EAAoB,MAApB,CAA9B,CAAP;AACH;;AA5EwB;;AA+E7BC,MAAM,CAACC,OAAP,GAAiBpC,KAAjB","sourcesContent":["\"use strict\";\n\nconst { _ } = require('@genx/july');\nconst { generateDisplayName, deepCloneField, Clonable, fieldNaming } = require('./GemlUtils');\nconst { Types } = require('@genx/data');\nconst RESERVED_KEYS = new Set(['name', 'type', 'modifiers', 'subClass', 'values']);\n\n/**\n * Oolong entity field class.\n * @class\n */\nclass Field extends Clonable {\n    /**\n     * @param {string} name\n     * @param {object} info\n     */\n    constructor(name, info) {\n        super();\n\n        this.name = fieldNaming(name);\n\n        /**\n         * Original type information.\n         * @member {object}\n         */\n        this.info = info;        \n    }\n\n    /**\n     * Linking the \n     */\n    link() {\n        assert: Types.Builtin.has(this.info.type);\n        let typeObject = Types[this.info.type];\n\n        _.forOwn(this.info, (value, key) => {\n            if (RESERVED_KEYS.has(key)) {\n                this[key] = value;\n                return;\n            }       \n\n            if (!typeObject.qualifiers.includes(key)) {\n                throw new Error(`Unsupported field qualifier \"${key}\" for type \"${this.info.type}\" of field \"${this.name}.\"`);\n            }\n\n            this[key] = Array.isArray(value) ? value[0] : value;\n        });\n\n        if (this.info.modifiers && _.find(this.info.modifiers, mod => mod.oolType === 'Activator')) {\n            this.hasActivator = true;\n        }\n\n        /**\n         * The default name of the field\n         * @member {string}\n         */\n        this.displayName = generateDisplayName(this.name);        \n\n        deepCloneField(this.info, this, 'modifiers');\n\n        this.linked = true;\n    }\n\n    hasSameType(targetField) {\n        return _.isEqual(this.toJSON(), targetField);\n    }\n\n    /**\n     * Clone the field     \n     * @returns {Field}\n     */\n    clone() {\n        super.clone();\n\n        let field = new Field(this.name, this.info);\n        Object.assign(field, this.toJSON());\n        field.linked = true;\n        \n        return field;\n    }\n\n    /**\n     * Translate the field into a plain JSON object\n     * @returns {object}\n     */\n    toJSON() {\n        return _.omit(_.toPlainObject(this), [ 'name', 'linked', 'info' ]);\n    }\n}\n\nmodule.exports = Field;"],"file":"Field.js"}
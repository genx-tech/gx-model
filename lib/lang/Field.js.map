{"version":3,"file":"Field.js","names":["_","require","generateDisplayName","deepCloneField","Clonable","fieldNaming","Types","RESERVED_KEYS","Set","Field","constructor","name","info","link","assert","Builtin","has","type","typeObject","forOwn","value","key","qualifiers","includes","Error","Array","isArray","modifiers","find","mod","oolType","hasActivator","displayName","linked","hasSameType","targetField","isEqual","toJSON","clone","field","Object","assign","omit","toPlainObject","module","exports"],"sources":["../../src/lang/Field.js"],"sourcesContent":["\"use strict\";\n\nconst { _ } = require('@genx/july');\nconst { generateDisplayName, deepCloneField, Clonable, fieldNaming } = require('./GemlUtils');\nconst { Types } = require('@genx/data');\nconst RESERVED_KEYS = new Set(['name', 'type', 'modifiers', 'subClass', 'values']);\n\n/**\n * Geml entity field class.\n * @class\n */\nclass Field extends Clonable {\n    /**\n     * @param {string} name\n     * @param {object} info\n     */\n    constructor(name, info) {\n        super();\n\n        this.name = fieldNaming(name);\n\n        /**\n         * Original type information.\n         * @member {object}\n         */\n        this.info = info;        \n    }\n\n    /**\n     * Linking the \n     */\n    link() {\n        assert: Types.Builtin.has(this.info.type);\n        let typeObject = Types[this.info.type];\n\n        _.forOwn(this.info, (value, key) => {\n            if (RESERVED_KEYS.has(key)) {\n                this[key] = value;\n                return;\n            }       \n\n            if (!typeObject.qualifiers.includes(key)) {\n                throw new Error(`Unsupported field qualifier \"${key}\" for type \"${this.info.type}\" of field \"${this.name}.\"`);\n            }\n\n            this[key] = Array.isArray(value) ? value[0] : value;\n        });\n\n        if (this.info.modifiers && _.find(this.info.modifiers, mod => mod.oolType === 'Activator')) {\n            this.hasActivator = true;\n        }\n\n        /**\n         * The default name of the field\n         * @member {string}\n         */\n        this.displayName = generateDisplayName(this.name);        \n\n        deepCloneField(this.info, this, 'modifiers');\n\n        this.linked = true;\n    }\n\n    hasSameType(targetField) {\n        return _.isEqual(this.toJSON(), targetField);\n    }\n\n    /**\n     * Clone the field     \n     * @returns {Field}\n     */\n    clone() {\n        super.clone();\n\n        let field = new Field(this.name, this.info);\n        Object.assign(field, this.toJSON());\n        field.linked = true;\n        \n        return field;\n    }\n\n    /**\n     * Translate the field into a plain JSON object\n     * @returns {object}\n     */\n    toJSON() {\n        return _.omit(_.toPlainObject(this), [ 'name', 'linked', 'info' ]);\n    }\n}\n\nmodule.exports = Field;"],"mappings":"AAAA;;;;AAEA,MAAM;EAAEA;AAAF,IAAQC,OAAO,CAAC,YAAD,CAArB;;AACA,MAAM;EAAEC,mBAAF;EAAuBC,cAAvB;EAAuCC,QAAvC;EAAiDC;AAAjD,IAAiEJ,OAAO,CAAC,aAAD,CAA9E;;AACA,MAAM;EAAEK;AAAF,IAAYL,OAAO,CAAC,YAAD,CAAzB;;AACA,MAAMM,aAAa,GAAG,IAAIC,GAAJ,CAAQ,CAAC,MAAD,EAAS,MAAT,EAAiB,WAAjB,EAA8B,UAA9B,EAA0C,QAA1C,CAAR,CAAtB;;AAMA,MAAMC,KAAN,SAAoBL,QAApB,CAA6B;EAKzBM,WAAW,CAACC,IAAD,EAAOC,IAAP,EAAa;IACpB;IAEA,KAAKD,IAAL,GAAYN,WAAW,CAACM,IAAD,CAAvB;IAMA,KAAKC,IAAL,GAAYA,IAAZ;EACH;;EAKDC,IAAI,GAAG;IACHC,MAAM,EAAER,KAAK,CAACS,OAAN,CAAcC,GAAd,CAAkB,KAAKJ,IAAL,CAAUK,IAA5B;;IACR,IAAIC,UAAU,GAAGZ,KAAK,CAAC,KAAKM,IAAL,CAAUK,IAAX,CAAtB;;IAEAjB,CAAC,CAACmB,MAAF,CAAS,KAAKP,IAAd,EAAoB,CAACQ,KAAD,EAAQC,GAAR,KAAgB;MAChC,IAAId,aAAa,CAACS,GAAd,CAAkBK,GAAlB,CAAJ,EAA4B;QACxB,KAAKA,GAAL,IAAYD,KAAZ;QACA;MACH;;MAED,IAAI,CAACF,UAAU,CAACI,UAAX,CAAsBC,QAAtB,CAA+BF,GAA/B,CAAL,EAA0C;QACtC,MAAM,IAAIG,KAAJ,CAAW,gCAA+BH,GAAI,eAAc,KAAKT,IAAL,CAAUK,IAAK,eAAc,KAAKN,IAAK,IAAnG,CAAN;MACH;;MAED,KAAKU,GAAL,IAAYI,KAAK,CAACC,OAAN,CAAcN,KAAd,IAAuBA,KAAK,CAAC,CAAD,CAA5B,GAAkCA,KAA9C;IACH,CAXD;;IAaA,IAAI,KAAKR,IAAL,CAAUe,SAAV,IAAuB3B,CAAC,CAAC4B,IAAF,CAAO,KAAKhB,IAAL,CAAUe,SAAjB,EAA4BE,GAAG,IAAIA,GAAG,CAACC,OAAJ,KAAgB,WAAnD,CAA3B,EAA4F;MACxF,KAAKC,YAAL,GAAoB,IAApB;IACH;;IAMD,KAAKC,WAAL,GAAmB9B,mBAAmB,CAAC,KAAKS,IAAN,CAAtC;IAEAR,cAAc,CAAC,KAAKS,IAAN,EAAY,IAAZ,EAAkB,WAAlB,CAAd;IAEA,KAAKqB,MAAL,GAAc,IAAd;EACH;;EAEDC,WAAW,CAACC,WAAD,EAAc;IACrB,OAAOnC,CAAC,CAACoC,OAAF,CAAU,KAAKC,MAAL,EAAV,EAAyBF,WAAzB,CAAP;EACH;;EAMDG,KAAK,GAAG;IACJ,MAAMA,KAAN;IAEA,IAAIC,KAAK,GAAG,IAAI9B,KAAJ,CAAU,KAAKE,IAAf,EAAqB,KAAKC,IAA1B,CAAZ;IACA4B,MAAM,CAACC,MAAP,CAAcF,KAAd,EAAqB,KAAKF,MAAL,EAArB;IACAE,KAAK,CAACN,MAAN,GAAe,IAAf;IAEA,OAAOM,KAAP;EACH;;EAMDF,MAAM,GAAG;IACL,OAAOrC,CAAC,CAAC0C,IAAF,CAAO1C,CAAC,CAAC2C,aAAF,CAAgB,IAAhB,CAAP,EAA8B,CAAE,MAAF,EAAU,QAAV,EAAoB,MAApB,CAA9B,CAAP;EACH;;AA5EwB;;AA+E7BC,MAAM,CAACC,OAAP,GAAiBpC,KAAjB"}
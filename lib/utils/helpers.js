"use strict";

require("source-map-support/register");

const path = require('path');

const {
  _,
  fs,
  eachAsync_
} = require('rk-utils');

exports.throwIfFileNotExist = (name, filePath) => {
  if (!fs.existsSync(filePath)) {
    throw new Error(`Path [${name}="${filePath}"] not exist.`);
  }
};

exports.getSchemaConnectors = (app, schemas) => _.mapValues(schemas, (schemaConfig, name) => {
  let connector = app.getService(schemaConfig.dataSource);

  if (!connector) {
    throw new Error(`Connector service not found for data source [${schemaConfig.dataSource}] of schmea "${name}".`);
  }

  return connector;
});

exports.getDateNamedDir = (baseDir, prefix, override) => {
  let now = new Date();
  prefix == null && (prefix = '');
  let folder = `${prefix}${now.getFullYear()}-${now.getMonth() + 1}-${now.getDate()}`;
  let outputDir = path.join(baseDir, folder);
  if (override) return outputDir;
  let num = 1;

  while (fs.existsSync(outputDir)) {
    let folder2 = folder + '_' + (++num).toString();
    outputDir = path.join(baseDir, folder2);
  }

  return outputDir;
};

async function importDataFilesByList(migrator, dataSetPath, dataListFile, ignoreDuplicate) {
  let dataList = fs.readFileSync(dataListFile).toString().match(/^.+$/gm);

  if (!dataList) {
    return;
  }

  return eachAsync_(dataList, async line => {
    line = line.trim();

    if (line.length > 0 && line[0] !== '#') {
      let dataFile = path.join(dataSetPath, line);

      if (!fs.existsSync(dataFile)) {
        throw new Error(`Data file "${dataFile}" not found.`);
      }

      await migrator.load_(dataFile, ignoreDuplicate);
    }
  });
}

exports.importDataFiles = async function (migrator, folderName, ignoreDuplicate) {
  let dataSetPath = path.join(migrator.dbScriptPath, 'data', folderName);
  if (!fs.existsSync(dataSetPath)) return;
  let dataListFile = path.join(dataSetPath, 'index.list');
  let runtimeDataSetPath,
      stageDataSetFile,
      imported = false;

  if (process.env.STAGE_ENV) {
    runtimeDataSetPath = path.join(dataSetPath, process.env.STAGE_ENV);
    stageDataSetFile = path.join(runtimeDataSetPath, 'index.list');
  }

  if (fs.existsSync(dataListFile)) {
    await importDataFilesByList(migrator, dataSetPath, dataListFile, ignoreDuplicate);
    imported = true;
  } else {
    migrator.app.log('warn', `Dataset index file "${dataListFile}" not exist.`);
  }

  if (stageDataSetFile && fs.existsSync(stageDataSetFile)) {
    await importDataFilesByList(migrator, runtimeDataSetPath, stageDataSetFile, ignoreDuplicate);
    imported = true;
  } else if (process.env.STAGE_ENV) {
    migrator.app.log(imported ? 'info' : 'warn', `Dataset index file of "${process.env.STAGE_ENV}" stage env "${stageDataSetFile}" not exist.`);
  }

  if (!imported) {
    throw new Error(`Entry file of dataset "${folderName}" not found.`);
  }
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy91dGlscy9oZWxwZXJzLmpzIl0sIm5hbWVzIjpbInBhdGgiLCJyZXF1aXJlIiwiXyIsImZzIiwiZWFjaEFzeW5jXyIsImV4cG9ydHMiLCJ0aHJvd0lmRmlsZU5vdEV4aXN0IiwibmFtZSIsImZpbGVQYXRoIiwiZXhpc3RzU3luYyIsIkVycm9yIiwiZ2V0U2NoZW1hQ29ubmVjdG9ycyIsImFwcCIsInNjaGVtYXMiLCJtYXBWYWx1ZXMiLCJzY2hlbWFDb25maWciLCJjb25uZWN0b3IiLCJnZXRTZXJ2aWNlIiwiZGF0YVNvdXJjZSIsImdldERhdGVOYW1lZERpciIsImJhc2VEaXIiLCJwcmVmaXgiLCJvdmVycmlkZSIsIm5vdyIsIkRhdGUiLCJmb2xkZXIiLCJnZXRGdWxsWWVhciIsImdldE1vbnRoIiwiZ2V0RGF0ZSIsIm91dHB1dERpciIsImpvaW4iLCJudW0iLCJmb2xkZXIyIiwidG9TdHJpbmciLCJpbXBvcnREYXRhRmlsZXNCeUxpc3QiLCJtaWdyYXRvciIsImRhdGFTZXRQYXRoIiwiZGF0YUxpc3RGaWxlIiwiaWdub3JlRHVwbGljYXRlIiwiZGF0YUxpc3QiLCJyZWFkRmlsZVN5bmMiLCJtYXRjaCIsImxpbmUiLCJ0cmltIiwibGVuZ3RoIiwiZGF0YUZpbGUiLCJsb2FkXyIsImltcG9ydERhdGFGaWxlcyIsImZvbGRlck5hbWUiLCJkYlNjcmlwdFBhdGgiLCJydW50aW1lRGF0YVNldFBhdGgiLCJzdGFnZURhdGFTZXRGaWxlIiwiaW1wb3J0ZWQiLCJwcm9jZXNzIiwiZW52IiwiU1RBR0VfRU5WIiwibG9nIl0sIm1hcHBpbmdzIjoiOzs7O0FBQUEsTUFBTUEsSUFBSSxHQUFHQyxPQUFPLENBQUMsTUFBRCxDQUFwQjs7QUFDQSxNQUFNO0FBQUVDLEVBQUFBLENBQUY7QUFBS0MsRUFBQUEsRUFBTDtBQUFTQyxFQUFBQTtBQUFULElBQXdCSCxPQUFPLENBQUMsVUFBRCxDQUFyQzs7QUFFQUksT0FBTyxDQUFDQyxtQkFBUixHQUE4QixDQUFD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cUIsQ0FBQ0MsUUFBRCxFQUFXZSxrQkFBWCxFQUErQkMsZ0JBQS9CLEVBQWlEYixlQUFqRCxDQUEzQjtBQUNBYyxJQUFBQSxRQUFRLEdBQUcsSUFBWDtBQUNILEdBSEQsTUFHTyxJQUFJQyxPQUFPLENBQUNDLEdBQVIsQ0FBWUMsU0FBaEIsRUFBMkI7QUFDOUJwQixJQUFBQSxRQUFRLENBQUN2QixHQUFULENBQWE0QyxHQUFiLENBQWlCSixRQUFRLEdBQUcsTUFBSCxHQUFZLE1BQXJDLEVBQThDLDBCQUF5QkMsT0FBTyxDQUFDQyxHQUFSLENBQVlDLFNBQVUsZ0JBQWVKLGdCQUFpQixjQUE3SDtBQUNIOztBQUVELE1BQUksQ0FBQ0MsUUFBTCxFQUFlO0FBQ1gsVUFBTSxJQUFJMUMsS0FBSixDQUFXLDBCQUF5QnNDLFVBQVcsY0FBL0MsQ0FBTjtBQUNIO0FBQ0gsQ0E5QkYiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBwYXRoID0gcmVxdWlyZSgncGF0aCcpO1xuY29uc3QgeyBfLCBmcywgZWFjaEFzeW5jXyB9ID0gcmVxdWlyZSgncmstdXRpbHMnKTtcblxuZXhwb3J0cy50aHJvd0lmRmlsZU5vdEV4aXN0ID0gKG5hbWUsIGZpbGVQYXRoKSA9PiB7XG4gICAgaWYgKCFmcy5leGlzdHNTeW5jKGZpbGVQYXRoKSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFBhdGggWyR7bmFtZX09XCIke2ZpbGVQYXRofVwiXSBub3QgZXhpc3QuYCk7XG4gICAgfVxufVxuXG5leHBvcnRzLmdldFNjaGVtYUNvbm5lY3RvcnMgPSAoYXBwLCBzY2hlbWFzKSA9PiBfLm1hcFZhbHVlcyhzY2hlbWFzLCAoc2NoZW1hQ29uZmlnLCBuYW1lKSA9PiB7XG4gICAgbGV0IGNvbm5lY3RvciA9IGFwcC5nZXRTZXJ2aWNlKHNjaGVtYUNvbmZpZy5kYXRhU291cmNlKTtcbiAgICBpZiAoIWNvbm5lY3Rvcikge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYENvbm5lY3RvciBzZXJ2aWNlIG5vdCBmb3VuZCBmb3IgZGF0YSBzb3VyY2UgWyR7c2NoZW1hQ29uZmlnLmRhdGFTb3VyY2V9XSBvZiBzY2htZWEgXCIke25hbWV9XCIuYCk7XG4gICAgfSBcbiAgICByZXR1cm4gY29ubmVjdG9yO1xufSk7XG5cbi8qKlxuICogR2V0IGRlZmF1bHQgcmV2ZXJzZSBvdXRwdXQgcGF0aC5cbiAqIEBwYXJhbSB7c3RyaW5nfSBwcmVmaXggXG4gKiBAcGFyYW0ge2Jvb2x9IG92ZXJyaWRlIFxuICogQHJldHVybnMge3N0cmluZ30gT3V0cHV0IHBhdGggb2Ygb29sb25nIGdlbmVyYXRlZCBmaWxlcy5cbiAqL1xuZXhwb3J0cy5nZXREYXRlTmFtZWREaXIgPSAoYmFzZURpciwgcHJlZml4LCBvdmVycmlkZSkgPT4ge1xuICAgIGxldCBub3cgPSBuZXcgRGF0ZSgpO1xuXG4gICAgKHByZWZpeCA9PSBudWxsKSAmJiAocHJlZml4ID0gJycpO1xuXG4gICAgbGV0IGZvbGRlciA9IGAke3ByZWZpeH0ke25vdy5nZXRGdWxsWWVhcigpfS0ke25vdy5nZXRNb250aCgpKzF9LSR7bm93LmdldERhdGUoKX1gO1xuICAgIGxldCBvdXRwdXREaXIgPSBwYXRoLmpvaW4oYmFzZURpciwgZm9sZGVyKTtcblxuICAgIGlmIChvdmVycmlkZSkgcmV0dXJuIG91dHB1dERpcjtcblxuICAgIGxldCBudW0gPSAxO1xuXG4gICAgd2hpbGUgKGZzLmV4aXN0c1N5bmMob3V0cHV0RGlyKSkge1xuICAgICAgICBsZXQgZm9sZGVyMiA9IGZvbGRlciArICdfJyArICgrK251bSkudG9TdHJpbmcoKTtcbiAgICAgICAgb3V0cHV0RGlyID0gcGF0aC5qb2luKGJhc2VEaXIsIGZvbGRlcjIpO1xuICAgIH1cblxuICAgIHJldHVybiBvdXRwdXREaXI7XG59O1xuXG5hc3luYyBmdW5jdGlvbiBpbXBvcnREYXRhRmlsZXNCeUxpc3QobWlncmF0b3IsIGRhdGFTZXRQYXRoLCBkYXRhTGlzdEZpbGUsIGlnbm9yZUR1cGxpY2F0ZSkge1xuICAgIGxldCBkYXRhTGlzdCA9IGZzLnJlYWRGaWxlU3luYyhkYXRhTGlzdEZpbGUpLnRvU3RyaW5nKCkubWF0Y2goL14uKyQvZ20pO1xuXG4gICAgaWYgKCFkYXRhTGlzdCkge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgcmV0dXJuIGVhY2hBc3luY18oZGF0YUxpc3QsIGFzeW5jIGxpbmUgPT4ge1xuICAgICAgICBsaW5lID0gbGluZS50cmltKCk7XG5cbiAgICAgICAgaWYgKGxpbmUubGVuZ3RoID4gMCAmJiBsaW5lWzBdICE9PSAnIycpIHsgICAgICAgICAgICBcbiAgICAgICAgICAgIGxldCBkYXRhRmlsZSA9IHBhdGguam9pbihkYXRhU2V0UGF0aCwgbGluZSk7XG4gICAgICAgICAgICBpZiAoIWZzLmV4aXN0c1N5bmMoZGF0YUZpbGUpKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBEYXRhIGZpbGUgXCIke2RhdGFGaWxlfVwiIG5vdCBmb3VuZC5gKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgYXdhaXQgbWlncmF0b3IubG9hZF8oZGF0YUZpbGUsIGlnbm9yZUR1cGxpY2F0ZSk7XG4gICAgICAgIH1cbiAgICB9KTsgXG59XG5cbmV4cG9ydHMuaW1wb3J0RGF0YUZpbGVzID0gYXN5bmMgZnVuY3Rpb24gKG1pZ3JhdG9yLCBmb2xkZXJOYW1lLCBpZ25vcmVEdXBsaWNhdGUpIHtcbiAgICBsZXQgZGF0YVNldFBhdGggPSBwYXRoLmpvaW4obWlncmF0b3IuZGJTY3JpcHRQYXRoLCAnZGF0YScsIGZvbGRlck5hbWUpO1xuICAgIGlmICghZnMuZXhpc3RzU3luYyhkYXRhU2V0UGF0aCkpIHJldHVybjtcblxuICAgIGxldCBkYXRhTGlzdEZpbGUgPSBwYXRoLmpvaW4oZGF0YVNldFBhdGgsICdpbmRleC5saXN0Jyk7XG5cbiAgICBsZXQgcnVudGltZURhdGFTZXRQYXRoLCBzdGFnZURhdGFTZXRGaWxlLCBpbXBvcnRlZCA9IGZhbHNlOyAgICBcblxuICAgIGlmIChwcm9jZXNzLmVudi5TVEFHRV9FTlYpIHtcbiAgICAgICAgcnVudGltZURhdGFTZXRQYXRoID0gcGF0aC5qb2luKGRhdGFTZXRQYXRoLCBwcm9jZXNzLmVudi5TVEFHRV9FTlYpOyAgICAgICAgXG4gICAgICAgIHN0YWdlRGF0YVNldEZpbGUgPSBwYXRoLmpvaW4ocnVudGltZURhdGFTZXRQYXRoLCAnaW5kZXgubGlzdCcpO1xuICAgIH0gICAgXG5cbiAgICBpZiAoZnMuZXhpc3RzU3luYyhkYXRhTGlzdEZpbGUpKSB7XG4gICAgICAgIGF3YWl0IGltcG9ydERhdGFGaWxlc0J5TGlzdChtaWdyYXRvciwgZGF0YVNldFBhdGgsIGRhdGFMaXN0RmlsZSwgaWdub3JlRHVwbGljYXRlKTsgICAgICBcbiAgICAgICAgaW1wb3J0ZWQgPSB0cnVlOyAgXG4gICAgfSBlbHNlIHtcbiAgICAgICAgbWlncmF0b3IuYXBwLmxvZygnd2FybicsIGBEYXRhc2V0IGluZGV4IGZpbGUgXCIke2RhdGFMaXN0RmlsZX1cIiBub3QgZXhpc3QuYClcbiAgICB9XG4gICAgXG4gICAgaWYgKHN0YWdlRGF0YVNldEZpbGUgJiYgZnMuZXhpc3RzU3luYyhzdGFnZURhdGFTZXRGaWxlKSkge1xuICAgICAgICBhd2FpdCBpbXBvcnREYXRhRmlsZXNCeUxpc3QobWlncmF0b3IsIHJ1bnRpbWVEYXRhU2V0UGF0aCwgc3RhZ2VEYXRhU2V0RmlsZSwgaWdub3JlRHVwbGljYXRlKTsgICAgXG4gICAgICAgIGltcG9ydGVkID0gdHJ1ZTsgICAgICBcbiAgICB9IGVsc2UgaWYgKHByb2Nlc3MuZW52LlNUQUdFX0VOVikge1xuICAgICAgICBtaWdyYXRvci5hcHAubG9nKGltcG9ydGVkID8gJ2luZm8nIDogJ3dhcm4nLCBgRGF0YXNldCBpbmRleCBmaWxlIG9mIFwiJHtwcm9jZXNzLmVudi5TVEFHRV9FTlZ9XCIgc3RhZ2UgZW52IFwiJHtzdGFnZURhdGFTZXRGaWxlfVwiIG5vdCBleGlzdC5gKVxuICAgIH1cbiAgICBcbiAgICBpZiAoIWltcG9ydGVkKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgRW50cnkgZmlsZSBvZiBkYXRhc2V0IFwiJHtmb2xkZXJOYW1lfVwiIG5vdCBmb3VuZC5gKTtcbiAgICB9ICAgIFxuIH0iXX0=
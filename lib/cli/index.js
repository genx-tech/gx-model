"use strict";

require("source-map-support/register");

const {
  Starters: {
    startCommand
  }
} = require('@genx/app');

const {
  _
} = require('rk-utils');

const pkg = require('../../package.json');

const AppInitiator = require('../AppInitiator');

const {
  Commands,
  getCommandOptions
} = require('./commands');

function main() {
  startCommand(app => {
    let cmd = app.commandLine;

    if (cmd.option('help')) {
      cmd.showUsage();
      return;
    }

    if (cmd.option('version')) {
      console.log(pkg.version);
      return;
    }

    let command = cmd.argv._[0];
    const appInitiator = new AppInitiator({
      app,
      cwd: process.cwd()
    });
    return appInitiator.run(command);
  }, {
    logger: {
      level: 'debug'
    },
    commandName: 'geml',
    config: {
      "version": pkg.version,
      "commandLine": {
        "banner": `Gen-X entity modeling command line v${pkg.version}`,
        "program": "geml",
        "arguments": [{
          "name": "command",
          "required": true,
          "inquire": true,
          "promptType": "list",
          "promptMessage": "What command are you going to execute?",
          "choicesProvider": _.map(Commands, (desc, cmd) => ({
            name: `${cmd} - ${desc}`,
            value: cmd
          })),
          "afterInquire": cli => {
            let cmd = cli.argv._[0];
            let options = getCommandOptions(cli, cmd);
            cli.usage.options = { ...cli.usage.options,
              ...options
            };
          }
        }],
        "options": {
          "s": {
            "desc": "Silent mode",
            "alias": ["silent"],
            "bool": true,
            "default": false
          },
          "v": {
            "desc": "Show version information",
            "alias": ["version"],
            "bool": true,
            "default": false
          },
          "?": {
            "desc": "Show usage message",
            "alias": ["help"],
            "bool": true,
            "default": false
          },
          "c": {
            "desc": "Config path",
            "alias": ["conf", "config"]
          }
        },
        "silentMode": cli => cli.argv['silent'] || cli.argv['version'] || cli.argv['help'],
        "nonValidationMode": cli => cli.argv['version'] || cli.argv['help'],
        "showUsageOnError": true,
        "showArguments": true
      }
    }
  });
}

;

if (!module.parent) {
  main();
} else {
  module.exports = main;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9jbGkvaW5kZXguanMiXSwibmFtZXMiOlsiU3RhcnRlcnMiLCJzdGFydENvbW1hbmQiLCJyZXF1aXJlIiwiXyIsInBrZyIsIkFwcEluaXRpYXRvciIsIkNvbW1hbmRzIiwiZ2V0Q29tbWFuZE9wdGlvbnMiLCJtYWluIiwiYXBwIiwiY21kIiwiY29tbWFuZExpbmUiLCJvcHRpb24iLCJzaG93VXNhZ2UiLCJjb25zb2xlIiwibG9nIiwidmVyc2lvbiIsImNvbW1hbmQiLCJhcmd2IiwiYXBwSW5pdGlhdG9yIiwiY3dkIiwicHJvY2VzcyIsInJ1biIsImxvZ2dlciIsImxldmVsIiwiY29tbWFuZE5hbWUiLCJjb25maWciLCJtYXAiLCJkZXNjIiwibmFtZSIsInZhbHVlIiwiY2xpIiwib3B0aW9ucyIsInVzYWdlIiwibW9kdWxlIiwicGFyZW50IiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE1BQU07QUFBRUEsRUFBQUEsUUFBUSxFQUFFO0FBQUVDLElBQUFBO0FBQUY7QUFBWixJQUFpQ0MsT0FBTyxDQUFDLFdBQUQsQ0FBOUM7O0FBQ0EsTUFBTTtBQUFFQyxFQUFBQTtBQUFGLElBQVFELE9BQU8sQ0FBQyxVQUFELENBQXJCOztBQUNBLE1BQU1FLEdBQUcsR0FBR0YsT0FBTyxDQUFDLG9CQUFELENBQW5COztBQUVBLE1BQU1HLFlBQVksR0FBR0gsT0FBTyxDQUFDLGlCQUFELENBQTVCOztBQUVBLE1BQU07QUFBRUksRUFBQUEsUUFBRjtBQUFZQyxFQUFBQTtBQUFaLElBQWtDTCxPQUFPLENBQUMsWUFBRCxDQUEvQzs7QUFFQSxTQUFTTSxJQUFULEdBQWlCO0FBQ2JQLEVBQUFBLFlBQVksQ0FBRVEsR0FBRCxJQUFTO0FBQ2xCLFFBQUlDLEdBQUcsR0FBR0QsR0FBRyxDQUFDRSxXQUFkOztBQUVBLFFBQUlELEdBQUcsQ0FBQ0UsTUFBSixDQUFXLE1BQVgsQ0FBSixFQUF3QjtBQUNwQkYsTUFBQUEsR0FBRyxDQUFDRyxTQUFKO0FBQ0E7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QUFaLEVBQW9CO0FBQ2hCM0IsRUFBQUEsSUFBSTtBQUNQLENBRkQsTUFFTztBQUNIMEIsRUFBQUEsTUFBTSxDQUFDRSxPQUFQLEdBQWlCNUIsSUFBakI7QUFDSCIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IHsgU3RhcnRlcnM6IHsgc3RhcnRDb21tYW5kIH0gfSA9IHJlcXVpcmUoJ0BnZW54L2FwcCcpO1xuY29uc3QgeyBfIH0gPSByZXF1aXJlKCdyay11dGlscycpO1xuY29uc3QgcGtnID0gcmVxdWlyZSgnLi4vLi4vcGFja2FnZS5qc29uJyk7XG5cbmNvbnN0IEFwcEluaXRpYXRvciA9IHJlcXVpcmUoJy4uL0FwcEluaXRpYXRvcicpO1xuXG5jb25zdCB7IENvbW1hbmRzLCBnZXRDb21tYW5kT3B0aW9ucyB9ID0gcmVxdWlyZSgnLi9jb21tYW5kcycpO1xuXG5mdW5jdGlvbiBtYWluICgpIHtcbiAgICBzdGFydENvbW1hbmQoKGFwcCkgPT4ge1xuICAgICAgICBsZXQgY21kID0gYXBwLmNvbW1hbmRMaW5lO1xuXG4gICAgICAgIGlmIChjbWQub3B0aW9uKCdoZWxwJykpIHtcbiAgICAgICAgICAgIGNtZC5zaG93VXNhZ2UoKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChjbWQub3B0aW9uKCd2ZXJzaW9uJykpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKHBrZy52ZXJzaW9uKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCBjb21tYW5kID0gY21kLmFyZ3YuX1swXTtcblxuICAgICAgICBjb25zdCBhcHBJbml0aWF0b3IgPSBuZXcgQXBwSW5pdGlhdG9yKHsgIFxuICAgICAgICAgICAgYXBwLFxuICAgICAgICAgICAgY3dkOiBwcm9jZXNzLmN3ZCgpXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiBhcHBJbml0aWF0b3IucnVuKGNvbW1hbmQpO1xuICAgIH0sIHtcbiAgICAgICAgbG9nZ2VyOiB7XG4gICAgICAgICAgICBsZXZlbDogJ2RlYnVnJ1xuICAgICAgICB9LFxuICAgICAgICBjb21tYW5kTmFtZTogJ2dlbWwnLFxuICAgICAgICBjb25maWc6IHtcbiAgICAgICAgICAgIFwidmVyc2lvblwiOiBwa2cudmVyc2lvbixcbiAgICAgICAgICAgIFwiY29tbWFuZExpbmVcIjoge1xuICAgICAgICAgICAgICAgIFwiYmFubmVyXCI6IGBHZW4tWCBlbnRpdHkgbW9kZWxpbmcgY29tbWFuZCBsaW5lIHYke3BrZy52ZXJzaW9ufWAsXG4gICAgICAgICAgICAgICAgXCJwcm9ncmFtXCI6IFwiZ2VtbFwiLCAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIFwiYXJndW1lbnRzXCI6IFtcbiAgICAgICAgICAgICAgICAgICAgeyBcbiAgICAgICAgICAgICAgICAgICAgICAgIFwibmFtZVwiOiBcImNvbW1hbmRcIiwgXG4gICAgICAgICAgICAgICAgICAgICAgICBcInJlcXVpcmVkXCI6IHRydWUsIFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJpbnF1aXJlXCI6IHRydWUsIFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJwcm9tcHRUeXBlXCI6IFwibGlzdFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJwcm9tcHRNZXNzYWdlXCI6IFwiV2hhdCBjb21tYW5kIGFyZSB5b3UgZ29pbmcgdG8gZXhlY3V0ZT9cIixcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiY2hvaWNlc1Byb3ZpZGVyXCI6IF8ubWFwKENvbW1hbmRzLCAoZGVzYywgY21kKSA9PiAoeyBuYW1lOiBgJHtjbWR9IC0gJHtkZXNjfWAsIHZhbHVlOiBjbWQgfSkpLFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJhZnRlcklucXVpcmVcIjogKGNsaSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBjbWQgPSBjbGkuYXJndi5fWzBdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBvcHRpb25zID0gZ2V0Q29tbWFuZE9wdGlvbnMoY2xpLCBjbWQpOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xpLnVzYWdlLm9wdGlvbnMgPSB7IC4uLmNsaS51c2FnZS5vcHRpb25zLCAuLi5vcHRpb25zIH07XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBdLCAgXG4gICAgICAgICAgICAgICAgXCJvcHRpb25zXCI6IHsgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgIFwic1wiOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBcImRlc2NcIjogXCJTaWxlbnQgbW9kZVwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJhbGlhc1wiOiBbIFwic2lsZW50XCIgXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiYm9vbFwiOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJkZWZhdWx0XCI6IGZhbHNlXG4gICAgICAgICAgICAgICAgICAgIH0sICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgIFwidlwiOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBcImRlc2NcIjogXCJTaG93IHZlcnNpb24gaW5mb3JtYXRpb25cIixcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiYWxpYXNcIjogWyBcInZlcnNpb25cIiBdLFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJib29sXCI6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBcImRlZmF1bHRcIjogZmFsc2VcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgXCI/XCI6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiZGVzY1wiOiBcIlNob3cgdXNhZ2UgbWVzc2FnZVwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJhbGlhc1wiOiBbIFwiaGVscFwiIF0sXG4gICAgICAgICAgICAgICAgICAgICAgICBcImJvb2xcIjogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiZGVmYXVsdFwiOiBmYWxzZVxuICAgICAgICAgICAgICAgICAgICB9LCAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgIFwiY1wiOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBcImRlc2NcIjogXCJDb25maWcgcGF0aFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJhbGlhc1wiOiBbIFwiY29uZlwiLCBcImNvbmZpZ1wiIF1cbiAgICAgICAgICAgICAgICAgICAgfSAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBcInNpbGVudE1vZGVcIjogY2xpID0+IChjbGkuYXJndlsnc2lsZW50J10gfHwgY2xpLmFyZ3ZbJ3ZlcnNpb24nXSB8fCBjbGkuYXJndlsnaGVscCddKSxcbiAgICAgICAgICAgICAgICBcIm5vblZhbGlkYXRpb25Nb2RlXCI6IGNsaSA9PiAoY2xpLmFyZ3ZbJ3ZlcnNpb24nXSB8fCBjbGkuYXJndlsnaGVscCddKSxcbiAgICAgICAgICAgICAgICBcInNob3dVc2FnZU9uRXJyb3JcIjogdHJ1ZSxcbiAgICAgICAgICAgICAgICBcInNob3dBcmd1bWVudHNcIjogdHJ1ZVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSk7XG59O1xuXG5pZiAoIW1vZHVsZS5wYXJlbnQpIHtcbiAgICBtYWluKCk7XG59IGVsc2Uge1xuICAgIG1vZHVsZS5leHBvcnRzID0gbWFpbjtcbn0iXX0=
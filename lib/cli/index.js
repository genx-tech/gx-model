"use strict";

require("source-map-support/register");

const {
  Starters: {
    startCommand
  }
} = require('@genx/app');

const {
  _
} = require('rk-utils');

const pkg = require('../../package.json');

const AppInitiator = require('../AppInitiator');

const {
  Commands,
  getCommandOptions
} = require('./commands');

const afterCommandConfirmed = cli => {
  let cmd = cli.argv._[0];
  let options = getCommandOptions(cli, cmd);
  cli.usage.options = { ...cli.usage.options,
    ...options
  };
  cli.parse(cli.usage.options);
};

function main() {
  startCommand(app => {
    let cmd = app.commandLine;

    if (cmd.option('help')) {
      cmd.showUsage();
      return;
    }

    if (cmd.option('version')) {
      console.log(pkg.version);
      return;
    }

    let command = cmd.argv._[0];
    const appInitiator = new AppInitiator({
      app,
      cwd: process.cwd()
    });
    return appInitiator.run(command);
  }, {
    logger: {
      level: process.env.VERBOSE ? 'verbose' : 'info'
    },
    commandName: 'geml',
    config: {
      "version": pkg.version,
      "commandLine": {
        "banner": `Gen-X entity modeling command line v${pkg.version}`,
        "program": "geml",
        "arguments": [{
          "name": "command",
          "required": true,
          "inquire": true,
          "promptType": "list",
          "promptMessage": "What command are you going to execute?",
          "choicesProvider": _.map(Commands, (desc, cmd) => ({
            name: `${cmd} - ${desc}`,
            value: cmd
          })),
          "afterInquire": afterCommandConfirmed,
          "onArgumentExists": afterCommandConfirmed
        }],
        "options": {
          "s": {
            "desc": "Silent mode",
            "alias": ["silent"],
            "bool": true,
            "default": false
          },
          "v": {
            "desc": "Show version information",
            "alias": ["version"],
            "bool": true,
            "default": false
          },
          "?": {
            "desc": "Show usage message",
            "alias": ["help"],
            "bool": true,
            "default": false
          },
          "c": {
            "desc": "Config path",
            "alias": ["conf", "config"]
          }
        },
        "silentMode": cli => cli.argv['silent'] || cli.argv['version'] || cli.argv['help'],
        "nonValidationMode": cli => cli.argv['version'] || cli.argv['help'],
        "showUsageOnError": true,
        "showArguments": true
      }
    }
  });
}

;

if (!module.parent) {
  main();
} else {
  module.exports = main;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9jbGkvaW5kZXguanMiXSwibmFtZXMiOlsiU3RhcnRlcnMiLCJzdGFydENvbW1hbmQiLCJyZXF1aXJlIiwiXyIsInBrZyIsIkFwcEluaXRpYXRvciIsIkNvbW1hbmRzIiwiZ2V0Q29tbWFuZE9wdGlvbnMiLCJhZnRlckNvbW1hbmRDb25maXJtZWQiLCJjbGkiLCJjbWQiLCJhcmd2Iiwib3B0aW9ucyIsInVzYWdlIiwicGFyc2UiLCJtYWluIiwiYXBwIiwiY29tbWFuZExpbmUiLCJvcHRpb24iLCJzaG93VXNhZ2UiLCJjb25zb2xlIiwibG9nIiwidmVyc2lvbiIsImNvbW1hbmQiLCJhcHBJbml0aWF0b3IiLCJjd2QiLCJwcm9jZXNzIiwicnVuIiwibG9nZ2VyIiwibGV2ZWwiLCJlbnYiLCJWRVJCT1NFIiwiY29tbWFuZE5hbWUiLCJjb25maWciLCJtYXAiLCJkZXNjIiwibmFtZSIsInZhbHVlIiwibW9kdWxlIiwicGFyZW50IiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE1BQU07QUFBRUEsRUFBQUEsUUFBUSxFQUFFO0FBQUVDLElBQUFBO0FBQUY7QUFBWixJQUFpQ0MsT0FBTyxDQUFDLFdBQUQsQ0FBOUM7O0FBQ0EsTUFBTTtBQUFFQyxFQUFBQTtBQUFGLElBQVFELE9BQU8sQ0FBQyxVQUFELENBQXJCOztBQUNBLE1BQU1FLEdBQUcsR0FBR0YsT0FBTyxDQUFDLG9CQUFELENBQW5COztBQUVBLE1BQU1HLFlBQVksR0FBR0gsT0FBTyxDQUFDLGlCQUFELENBQTVCOztBQUVBLE1BQU07QUFBRUksRUFBQUEsUUFBRjtBQUFZQyxFQUFBQTtBQUFaLElBQWtDTCxPQUFPLENBQUMsWUFBRCxDQUEvQzs7QUFFQSxNQUFNTSxxQkFBcUIsR0FBSUMsR0FBRCxJQUFTO0FBQ25DLE1BQUlDLEdBQUcsR0FBR0QsR0FBRyxDQUFDRSxJQUFKLENBQVNSLENBQVQsQ0FBVyxDQUFYLENBQVY7QUFDQSxNQUFJUyxPQUFPLEdBQUdMLGlCQUFpQixD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QVQsQ0F2Q3hEO0FBd0NYLDZCQUFxQkYsR0FBRyxJQUFLQSxHQUFHLENBQUNFLElBQUosQ0FBUyxTQUFULEtBQXVCRixHQUFHLENBQUNFLElBQUosQ0FBUyxNQUFULENBeEN6QztBQXlDWCw0QkFBb0IsSUF6Q1Q7QUEwQ1gseUJBQWlCO0FBMUNOO0FBRlg7QUFMVCxHQXJCUyxDQUFaO0FBMEVIOztBQUFBOztBQUVELElBQUksQ0FBQzJCLE1BQU0sQ0FBQ0MsTUFBWixFQUFvQjtBQUNoQnhCLEVBQUFBLElBQUk7QUFDUCxDQUZELE1BRU87QUFDSHVCLEVBQUFBLE1BQU0sQ0FBQ0UsT0FBUCxHQUFpQnpCLElBQWpCO0FBQ0giLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCB7IFN0YXJ0ZXJzOiB7IHN0YXJ0Q29tbWFuZCB9IH0gPSByZXF1aXJlKCdAZ2VueC9hcHAnKTtcbmNvbnN0IHsgXyB9ID0gcmVxdWlyZSgncmstdXRpbHMnKTtcbmNvbnN0IHBrZyA9IHJlcXVpcmUoJy4uLy4uL3BhY2thZ2UuanNvbicpO1xuXG5jb25zdCBBcHBJbml0aWF0b3IgPSByZXF1aXJlKCcuLi9BcHBJbml0aWF0b3InKTtcblxuY29uc3QgeyBDb21tYW5kcywgZ2V0Q29tbWFuZE9wdGlvbnMgfSA9IHJlcXVpcmUoJy4vY29tbWFuZHMnKTtcblxuY29uc3QgYWZ0ZXJDb21tYW5kQ29uZmlybWVkID0gKGNsaSkgPT4ge1xuICAgIGxldCBjbWQgPSBjbGkuYXJndi5fWzBdO1xuICAgIGxldCBvcHRpb25zID0gZ2V0Q29tbWFuZE9wdGlvbnMoY2xpLCBjbWQpOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgY2xpLnVzYWdlLm9wdGlvbnMgPSB7IC4uLmNsaS51c2FnZS5vcHRpb25zLCAuLi5vcHRpb25zIH07ICAgIFxuICAgIGNsaS5wYXJzZShjbGkudXNhZ2Uub3B0aW9ucyk7XG59O1xuXG5mdW5jdGlvbiBtYWluICgpIHtcbiAgICBzdGFydENvbW1hbmQoKGFwcCkgPT4ge1xuICAgICAgICBsZXQgY21kID0gYXBwLmNvbW1hbmRMaW5lO1xuXG4gICAgICAgIGlmIChjbWQub3B0aW9uKCdoZWxwJykpIHtcbiAgICAgICAgICAgIGNtZC5zaG93VXNhZ2UoKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChjbWQub3B0aW9uKCd2ZXJzaW9uJykpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKHBrZy52ZXJzaW9uKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCBjb21tYW5kID0gY21kLmFyZ3YuX1swXTtcblxuICAgICAgICBjb25zdCBhcHBJbml0aWF0b3IgPSBuZXcgQXBwSW5pdGlhdG9yKHsgIFxuICAgICAgICAgICAgYXBwLFxuICAgICAgICAgICAgY3dkOiBwcm9jZXNzLmN3ZCgpXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiBhcHBJbml0aWF0b3IucnVuKGNvbW1hbmQpO1xuICAgIH0sIHtcbiAgICAgICAgbG9nZ2VyOiB7XG4gICAgICAgICAgICBsZXZlbDogcHJvY2Vzcy5lbnYuVkVSQk9TRSA/ICd2ZXJib3NlJyA6ICdpbmZvJ1xuICAgICAgICB9LFxuICAgICAgICBjb21tYW5kTmFtZTogJ2dlbWwnLFxuICAgICAgICBjb25maWc6IHtcbiAgICAgICAgICAgIFwidmVyc2lvblwiOiBwa2cudmVyc2lvbixcbiAgICAgICAgICAgIFwiY29tbWFuZExpbmVcIjoge1xuICAgICAgICAgICAgICAgIFwiYmFubmVyXCI6IGBHZW4tWCBlbnRpdHkgbW9kZWxpbmcgY29tbWFuZCBsaW5lIHYke3BrZy52ZXJzaW9ufWAsXG4gICAgICAgICAgICAgICAgXCJwcm9ncmFtXCI6IFwiZ2VtbFwiLCAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIFwiYXJndW1lbnRzXCI6IFtcbiAgICAgICAgICAgICAgICAgICAgeyBcbiAgICAgICAgICAgICAgICAgICAgICAgIFwibmFtZVwiOiBcImNvbW1hbmRcIiwgXG4gICAgICAgICAgICAgICAgICAgICAgICBcInJlcXVpcmVkXCI6IHRydWUsIFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJpbnF1aXJlXCI6IHRydWUsIFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJwcm9tcHRUeXBlXCI6IFwibGlzdFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJwcm9tcHRNZXNzYWdlXCI6IFwiV2hhdCBjb21tYW5kIGFyZSB5b3UgZ29pbmcgdG8gZXhlY3V0ZT9cIixcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiY2hvaWNlc1Byb3ZpZGVyXCI6IF8ubWFwKENvbW1hbmRzLCAoZGVzYywgY21kKSA9PiAoeyBuYW1lOiBgJHtjbWR9IC0gJHtkZXNjfWAsIHZhbHVlOiBjbWQgfSkpLFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJhZnRlcklucXVpcmVcIjogYWZ0ZXJDb21tYW5kQ29uZmlybWVkLFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJvbkFyZ3VtZW50RXhpc3RzXCI6IGFmdGVyQ29tbWFuZENvbmZpcm1lZFxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgXSwgIFxuICAgICAgICAgICAgICAgIFwib3B0aW9uc1wiOiB7ICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICBcInNcIjoge1xuICAgICAgICAgICAgICAgICAgICAgICAgXCJkZXNjXCI6IFwiU2lsZW50IG1vZGVcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiYWxpYXNcIjogWyBcInNpbGVudFwiIF0sXG4gICAgICAgICAgICAgICAgICAgICAgICBcImJvb2xcIjogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiZGVmYXVsdFwiOiBmYWxzZVxuICAgICAgICAgICAgICAgICAgICB9LCAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICBcInZcIjoge1xuICAgICAgICAgICAgICAgICAgICAgICAgXCJkZXNjXCI6IFwiU2hvdyB2ZXJzaW9uIGluZm9ybWF0aW9uXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBcImFsaWFzXCI6IFsgXCJ2ZXJzaW9uXCIgXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiYm9vbFwiOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJkZWZhdWx0XCI6IGZhbHNlXG4gICAgICAgICAgICAgICAgICAgIH0sICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICBcIj9cIjoge1xuICAgICAgICAgICAgICAgICAgICAgICAgXCJkZXNjXCI6IFwiU2hvdyB1c2FnZSBtZXNzYWdlXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBcImFsaWFzXCI6IFsgXCJoZWxwXCIgXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiYm9vbFwiOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJkZWZhdWx0XCI6IGZhbHNlXG4gICAgICAgICAgICAgICAgICAgIH0sICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgXCJjXCI6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiZGVzY1wiOiBcIkNvbmZpZyBwYXRoXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBcImFsaWFzXCI6IFsgXCJjb25mXCIsIFwiY29uZmlnXCIgXVxuICAgICAgICAgICAgICAgICAgICB9ICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIFwic2lsZW50TW9kZVwiOiBjbGkgPT4gKGNsaS5hcmd2WydzaWxlbnQnXSB8fCBjbGkuYXJndlsndmVyc2lvbiddIHx8IGNsaS5hcmd2WydoZWxwJ10pLFxuICAgICAgICAgICAgICAgIFwibm9uVmFsaWRhdGlvbk1vZGVcIjogY2xpID0+IChjbGkuYXJndlsndmVyc2lvbiddIHx8IGNsaS5hcmd2WydoZWxwJ10pLFxuICAgICAgICAgICAgICAgIFwic2hvd1VzYWdlT25FcnJvclwiOiB0cnVlLFxuICAgICAgICAgICAgICAgIFwic2hvd0FyZ3VtZW50c1wiOiB0cnVlXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9KTtcbn07XG5cbmlmICghbW9kdWxlLnBhcmVudCkge1xuICAgIG1haW4oKTtcbn0gZWxzZSB7XG4gICAgbW9kdWxlLmV4cG9ydHMgPSBtYWluO1xufSJdfQ==
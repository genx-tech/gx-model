"use strict";

require("source-map-support/register");

const {
  _,
  eachAsync_
} = require('rk-utils');

const {
  throwIfFileNotExist,
  importDataFiles
} = require('../utils/helpers');

module.exports = async (app, context) => {
  app.log('verbose', 'geml import');
  throwIfFileNotExist("modelPath", context.modelPath);
  throwIfFileNotExist("scriptPath", context.scriptPath);
  let schemaName = app.option('schema');
  let dataset = app.option('dataset');
  let ignoreDuplicate = app.option('ignore');
  let schemaConfig = context.schemas[schemaName];

  if (!schemaConfig) {
    throw new Error(`Schema "${schemaName}" not found in geml config.`);
  }

  const db = app.db(schemaName);

  const Migrator = require(`../migration/${db.driver}`);

  const migrator = new Migrator(app, context, db);
  await importDataFiles(migrator, dataset, ignoreDuplicate);
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9jb21tYW5kcy9pbXBvcnQuanMiXSwibmFtZXMiOlsiXyIsImVhY2hBc3luY18iLCJyZXF1aXJlIiwidGhyb3dJZkZpbGVOb3RFeGlzdCIsImltcG9ydERhdGFGaWxlcyIsIm1vZHVsZSIsImV4cG9ydHMiLCJhcHAiLCJjb250ZXh0IiwibG9nIiwibW9kZWxQYXRoIiwic2NyaXB0UGF0aCIsInNjaGVtYU5hbWUiLCJvcHRpb24iLCJkYXRhc2V0IiwiaWdub3JlRHVwbGljYXRlIiwic2NoZW1hQ29uZmlnIiwic2NoZW1hcyIsIkVycm9yIiwiZGIiLCJNaWdyYXRvciIsImRyaXZlciIsIm1pZ3JhdG9yIl0sIm1hcHBpbmdzIjoiOzs7O0FBQUEsTUFBTTtBQUFFQSxFQUFBQSxDQUFGO0FBQUtDLEVBQUFBO0FBQUwsSUFBb0JDLE9BQU8sQ0FBQyxVQUFELENBQWpDOztBQUNBLE1BQU07QUFBRUMsRUFBQUEsbUJBQUY7QUFBdUJDLEVBQUFBO0FBQXZCLElBQTJDRixPQUFPLENBQUMsa0JBQUQsQ0FBeEQ7O0FBZUFHLE1BQU0sQ0FBQ0MsT0FBUCxHQUFpQixPQUFPQyxHQUFQLEVBQVlDLE9BQVosS0FBd0I7QUFDckNELEVBQUFBLEdBQUcsQ0FBQ0UsR0FBSixDQUFRLFNBQVIsRUFBbUIsYUFBbkI7QUFFQU4sRUFBQUEsbUJBQW1CLENBQUMsV0FBRCxFQUFjSyxPQUFPLENBQUNFLFNBQXRCLENBQW5CO0FBQ0FQLEVBQUFBLG1CQUFtQixDQUFDLFlBQUQsRUFBZUssT0FBTyxDQUFDRyxVQUF2QixDQUFuQjtBQUVBLE1BQUlDLFVBQVUsR0FBR0wsR0FBRyxDQUFDTSxNQUFKLENBQVcsUUFBWCxDQUFqQjtBQUNBLE1BQUlDLE9BQU8sR0FBR1AsR0FBRyxDQUFDTSxNQUFKLENBQVcsU0FBWCxDQUFkO0FBQ0EsTUFBSUUsZUFBZSxHQUFHUixHQUFHLENBQUNNLE1BQUosQ0FBVyxRQUFYLENBQXRCO0FBRUEsTUFBSUcsWUFBWSxHQUFHUixPQUFPLENBQUNTLE9BQVIsQ0FBZ0JMLFVBQWhCLENBQW5COztBQUNBLE1BQUksQ0FBQ0ksWUFBTCxFQUFtQjtBQUNmLFVBQU0sSUFBSUUsS0FBSixDQUFXLFdBQVVOLFVBQVcsNkJBQWhDLENBQU47QUFDSDs7QUFFRCxRQUFNTyxFQUFFLEdBQUdaLEdBQUcsQ0FBQ1ksRUFBSixDQUFPUCxVQUFQLENBQVg7O0FBRUEsUUFBTVEsUUFBUSxHQUFHbEIsT0FBTyxDQUFFLGdCQUFlaUIsRUFBRSxDQUFDRSxNQUFPLEVBQTNCLENBQXhCOztBQUNBLFFBQU1DLFFBQVEsR0FBRyxJQUFJRixRQUFKLENBQWFiLEdBQWIsRUFBa0JDLE9BQWxCLEVBQTJCVyxFQUEzQixDQUFqQjtBQUVBLFFBQU1mLGVBQWUsQ0FBQ2tCLFFBQUQsRUFBV1IsT0FBWCxFQUFvQkMsZUFBcEIsQ0FBckI7QUFDSCxDQXJCRCIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IHsgXywgZWFjaEFzeW5jXyB9ID0gcmVxdWlyZSgncmstdXRpbHMnKTtcbmNvbnN0IHsgdGhyb3dJZkZpbGVOb3RFeGlzdCwgaW1wb3J0RGF0YUZpbGVzIH0gPSByZXF1aXJlKCcuLi91dGlscy9oZWxwZXJzJyk7XG5cbi8qKlxuICogQnVpbGQgZGF0YWJhc2Ugc2NyaXB0cyBhbmQgZW50aXR5IG1vZGVscyBmcm9tIG9vbG9uZyBmaWxlcy5cbiAqIEBwYXJhbSB7U2VydmljZUNvbnRhaW5lcn0gYXBwXG4gKiBAcGFyYW0ge29iamVjdH0gY29udGV4dCBcbiAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBjb250ZXh0LmdlbWxQYXRoXG4gKiBAcHJvcGVydHkge3N0cmluZ30gY29udGV4dC5tb2RlbFBhdGggICAgICAgICBcbiAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBjb250ZXh0LnNjcmlwdFBhdGhcbiAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBjb250ZXh0Lm1hbmlmZXN0UGF0aFxuICogQHByb3BlcnR5IHtib29sfSBjb250ZXh0LnVzZUpzb25Tb3VyY2VcbiAqIEBwcm9wZXJ0eSB7Ym9vbH0gY29udGV4dC5zYXZlSW50ZXJtZWRpYXRlXG4gKiBAcHJvcGVydHkge29iamVjdH0gY29udGV4dC5zY2hlbWFzICAgXG4gKiBAcmV0dXJucyB7UHJvbWlzZX1cbiAqL1xubW9kdWxlLmV4cG9ydHMgPSBhc3luYyAoYXBwLCBjb250ZXh0KSA9PiB7XG4gICAgYXBwLmxvZygndmVyYm9zZScsICdnZW1sIGltcG9ydCcpO1xuXG4gICAgdGhyb3dJZkZpbGVOb3RFeGlzdChcIm1vZGVsUGF0aFwiLCBjb250ZXh0Lm1vZGVsUGF0aCk7XG4gICAgdGhyb3dJZkZpbGVOb3RFeGlzdChcInNjcmlwdFBhdGhcIiwgY29udGV4dC5zY3JpcHRQYXRoKTtcblxuICAgIGxldCBzY2hlbWFOYW1lID0gYXBwLm9wdGlvbignc2NoZW1hJyk7XG4gICAgbGV0IGRhdGFzZXQgPSBhcHAub3B0aW9uKCdkYXRhc2V0Jyk7XG4gICAgbGV0IGlnbm9yZUR1cGxpY2F0ZSA9IGFwcC5vcHRpb24oJ2lnbm9yZScpO1xuXG4gICAgbGV0IHNjaGVtYUNvbmZpZyA9IGNvbnRleHQuc2NoZW1hc1tzY2hlbWFOYW1lXTtcbiAgICBpZiAoIXNjaGVtYUNvbmZpZykge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFNjaGVtYSBcIiR7c2NoZW1hTmFtZX1cIiBub3QgZm91bmQgaW4gZ2VtbCBjb25maWcuYCk7XG4gICAgfVxuXG4gICAgY29uc3QgZGIgPSBhcHAuZGIoc2NoZW1hTmFtZSk7ICAgICAgICBcbiAgICBcbiAgICBjb25zdCBNaWdyYXRvciA9IHJlcXVpcmUoYC4uL21pZ3JhdGlvbi8ke2RiLmRyaXZlcn1gKTtcbiAgICBjb25zdCBtaWdyYXRvciA9IG5ldyBNaWdyYXRvcihhcHAsIGNvbnRleHQsIGRiKTtcblxuICAgIGF3YWl0IGltcG9ydERhdGFGaWxlcyhtaWdyYXRvciwgZGF0YXNldCwgaWdub3JlRHVwbGljYXRlKTsgIFxufTtcbiJdfQ==
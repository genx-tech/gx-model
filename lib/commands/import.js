"use strict";

require("source-map-support/register");

const {
  _,
  eachAsync_
} = require('rk-utils');

const {
  throwIfFileNotExist,
  getSchemaConnectors,
  importDataFiles
} = require('../utils/helpers');

module.exports = async (app, context) => {
  app.log('verbose', 'geml import');
  throwIfFileNotExist("modelPath", context.modelPath);
  throwIfFileNotExist("scriptPath", context.scriptPath);
  let schemaName = app.option('schema');
  let dataset = app.option('dataset');
  let schemaConfig = context.schemas[schemaName];

  if (!schemaConfig) {
    throw new Error(`Schema "${schemaName}" not found in geml config.`);
  }

  const db = app.db(schemaName);

  const Migrator = require(`../migration/${db.driver}`);

  const migrator = new Migrator(app, context, db);
  await importDataFiles(migrator, dataset);
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9jb21tYW5kcy9pbXBvcnQuanMiXSwibmFtZXMiOlsiXyIsImVhY2hBc3luY18iLCJyZXF1aXJlIiwidGhyb3dJZkZpbGVOb3RFeGlzdCIsImdldFNjaGVtYUNvbm5lY3RvcnMiLCJpbXBvcnREYXRhRmlsZXMiLCJtb2R1bGUiLCJleHBvcnRzIiwiYXBwIiwiY29udGV4dCIsImxvZyIsIm1vZGVsUGF0aCIsInNjcmlwdFBhdGgiLCJzY2hlbWFOYW1lIiwib3B0aW9uIiwiZGF0YXNldCIsInNjaGVtYUNvbmZpZyIsInNjaGVtYXMiLCJFcnJvciIsImRiIiwiTWlncmF0b3IiLCJkcml2ZXIiLCJtaWdyYXRvciJdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE1BQU07QUFBRUEsRUFBQUEsQ0FBRjtBQUFLQyxFQUFBQTtBQUFMLElBQW9CQyxPQUFPLENBQUMsVUFBRCxDQUFqQzs7QUFDQSxNQUFNO0FBQUVDLEVBQUFBLG1CQUFGO0FBQXVCQyxFQUFBQSxtQkFBdkI7QUFBNENDLEVBQUFBO0FBQTVDLElBQWdFSCxPQUFPLENBQUMsa0JBQUQsQ0FBN0U7O0FBZUFJLE1BQU0sQ0FBQ0MsT0FBUCxHQUFpQixPQUFPQyxHQUFQLEVBQVlDLE9BQVosS0FBd0I7QUFDckNELEVBQUFBLEdBQUcsQ0FBQ0UsR0FBSixDQUFRLFNBQVIsRUFBbUIsYUFBbkI7QUFFQVAsRUFBQUEsbUJBQW1CLENBQUMsV0FBRCxFQUFjTSxPQUFPLENBQUNFLFNBQXRCLENBQW5CO0FBQ0FSLEVBQUFBLG1CQUFtQixDQUFDLFlBQUQsRUFBZU0sT0FBTyxDQUFDRyxVQUF2QixDQUFuQjtBQUVBLE1BQUlDLFVBQVUsR0FBR0wsR0FBRyxDQUFDTSxNQUFKLENBQVcsUUFBWCxDQUFqQjtBQUNBLE1BQUlDLE9BQU8sR0FBR1AsR0FBRyxDQUFDTSxNQUFKLENBQVcsU0FBWCxDQUFkO0FBRUEsTUFBSUUsWUFBWSxHQUFHUCxPQUFPLENBQUNRLE9BQVIsQ0FBZ0JKLFVBQWhCLENBQW5COztBQUNBLE1BQUksQ0FBQ0csWUFBTCxFQUFtQjtBQUNmLFVBQU0sSUFBSUUsS0FBSixDQUFXLFdBQVVMLFVBQVcsNkJBQWhDLENBQU47QUFDSDs7QUFFRCxRQUFNTSxFQUFFLEdBQUdYLEdBQUcsQ0FBQ1csRUFBSixDQUFPTixVQUFQLENBQVg7O0FBRUEsUUFBTU8sUUFBUSxHQUFHbEIsT0FBTyxDQUFFLGdCQUFlaUIsRUFBRSxDQUFDRSxNQUFPLEVBQTNCLENBQXhCOztBQUNBLFFBQU1DLFFBQVEsR0FBRyxJQUFJRixRQUFKLENBQWFaLEdBQWIsRUFBa0JDLE9BQWxCLEVBQTJCVSxFQUEzQixDQUFqQjtBQUVBLFFBQU1kLGVBQWUsQ0FBQ2lCLFFBQUQsRUFBV1AsT0FBWCxDQUFyQjtBQUNILENBcEJEIiwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgeyBfLCBlYWNoQXN5bmNfIH0gPSByZXF1aXJlKCdyay11dGlscycpO1xuY29uc3QgeyB0aHJvd0lmRmlsZU5vdEV4aXN0LCBnZXRTY2hlbWFDb25uZWN0b3JzLCBpbXBvcnREYXRhRmlsZXMgfSA9IHJlcXVpcmUoJy4uL3V0aWxzL2hlbHBlcnMnKTtcblxuLyoqXG4gKiBCdWlsZCBkYXRhYmFzZSBzY3JpcHRzIGFuZCBlbnRpdHkgbW9kZWxzIGZyb20gb29sb25nIGZpbGVzLlxuICogQHBhcmFtIHtTZXJ2aWNlQ29udGFpbmVyfSBhcHBcbiAqIEBwYXJhbSB7b2JqZWN0fSBjb250ZXh0IFxuICogQHByb3BlcnR5IHtzdHJpbmd9IGNvbnRleHQuZ2VtbFBhdGhcbiAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBjb250ZXh0Lm1vZGVsUGF0aCAgICAgICAgIFxuICogQHByb3BlcnR5IHtzdHJpbmd9IGNvbnRleHQuc2NyaXB0UGF0aFxuICogQHByb3BlcnR5IHtzdHJpbmd9IGNvbnRleHQubWFuaWZlc3RQYXRoXG4gKiBAcHJvcGVydHkge2Jvb2x9IGNvbnRleHQudXNlSnNvblNvdXJjZVxuICogQHByb3BlcnR5IHtib29sfSBjb250ZXh0LnNhdmVJbnRlcm1lZGlhdGVcbiAqIEBwcm9wZXJ0eSB7b2JqZWN0fSBjb250ZXh0LnNjaGVtYXMgICBcbiAqIEByZXR1cm5zIHtQcm9taXNlfVxuICovXG5tb2R1bGUuZXhwb3J0cyA9IGFzeW5jIChhcHAsIGNvbnRleHQpID0+IHtcbiAgICBhcHAubG9nKCd2ZXJib3NlJywgJ2dlbWwgaW1wb3J0Jyk7XG5cbiAgICB0aHJvd0lmRmlsZU5vdEV4aXN0KFwibW9kZWxQYXRoXCIsIGNvbnRleHQubW9kZWxQYXRoKTtcbiAgICB0aHJvd0lmRmlsZU5vdEV4aXN0KFwic2NyaXB0UGF0aFwiLCBjb250ZXh0LnNjcmlwdFBhdGgpO1xuXG4gICAgbGV0IHNjaGVtYU5hbWUgPSBhcHAub3B0aW9uKCdzY2hlbWEnKTtcbiAgICBsZXQgZGF0YXNldCA9IGFwcC5vcHRpb24oJ2RhdGFzZXQnKTtcblxuICAgIGxldCBzY2hlbWFDb25maWcgPSBjb250ZXh0LnNjaGVtYXNbc2NoZW1hTmFtZV07XG4gICAgaWYgKCFzY2hlbWFDb25maWcpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBTY2hlbWEgXCIke3NjaGVtYU5hbWV9XCIgbm90IGZvdW5kIGluIGdlbWwgY29uZmlnLmApO1xuICAgIH1cblxuICAgIGNvbnN0IGRiID0gYXBwLmRiKHNjaGVtYU5hbWUpOyAgICAgICAgXG4gICAgXG4gICAgY29uc3QgTWlncmF0b3IgPSByZXF1aXJlKGAuLi9taWdyYXRpb24vJHtkYi5kcml2ZXJ9YCk7XG4gICAgY29uc3QgbWlncmF0b3IgPSBuZXcgTWlncmF0b3IoYXBwLCBjb250ZXh0LCBkYik7XG5cbiAgICBhd2FpdCBpbXBvcnREYXRhRmlsZXMobWlncmF0b3IsIGRhdGFzZXQpOyAgXG59O1xuIl19
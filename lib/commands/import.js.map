{"version":3,"file":"import.js","names":["throwIfFileNotExist","importDataFiles","require","module","exports","app","context","log","name","modelPath","scriptPath","schemaName","option","dataset","ignoreDuplicate","schemaConfig","schemas","Error","db","Migrator","driver","migrator"],"sources":["../../src/commands/import.js"],"sourcesContent":["const { throwIfFileNotExist, importDataFiles } = require('../utils/helpers');\n\n/**\n * Build database scripts and entity models from oolong files.\n * @param {ServiceContainer} app\n * @param {object} context \n * @property {string} context.gemlPath\n * @property {string} context.modelPath         \n * @property {string} context.scriptPath\n * @property {string} context.manifestPath\n * @property {bool} context.useJsonSource\n * @property {bool} context.saveIntermediate\n * @property {object} context.schemas   \n * @returns {Promise}\n */\nmodule.exports = async (app, context) => {\n    app.log('verbose', `${app.name} import`);\n\n    throwIfFileNotExist(\"modelPath\", context.modelPath);\n    throwIfFileNotExist(\"scriptPath\", context.scriptPath);\n\n    let schemaName = app.option('schema');\n    let dataset = app.option('dataset');\n    let ignoreDuplicate = app.option('ignore');\n\n    let schemaConfig = context.schemas[schemaName];\n    if (!schemaConfig) {\n        throw new Error(`Schema \"${schemaName}\" not found in geml config.`);\n    }\n\n    const db = app.db(schemaName);        \n    \n    const Migrator = require(`../migration/${db.driver}`);\n    const migrator = new Migrator(app, context, db);\n\n    await importDataFiles(migrator, dataset, ignoreDuplicate);  \n};\n"],"mappings":";;;;AAAA,MAAM;EAAEA,mBAAF;EAAuBC;AAAvB,IAA2CC,OAAO,CAAC,kBAAD,CAAxD;;AAeAC,MAAM,CAACC,OAAP,GAAiB,OAAOC,GAAP,EAAYC,OAAZ,KAAwB;EACrCD,GAAG,CAACE,GAAJ,CAAQ,SAAR,EAAoB,GAAEF,GAAG,CAACG,IAAK,SAA/B;EAEAR,mBAAmB,CAAC,WAAD,EAAcM,OAAO,CAACG,SAAtB,CAAnB;EACAT,mBAAmB,CAAC,YAAD,EAAeM,OAAO,CAACI,UAAvB,CAAnB;EAEA,IAAIC,UAAU,GAAGN,GAAG,CAACO,MAAJ,CAAW,QAAX,CAAjB;EACA,IAAIC,OAAO,GAAGR,GAAG,CAACO,MAAJ,CAAW,SAAX,CAAd;EACA,IAAIE,eAAe,GAAGT,GAAG,CAACO,MAAJ,CAAW,QAAX,CAAtB;EAEA,IAAIG,YAAY,GAAGT,OAAO,CAACU,OAAR,CAAgBL,UAAhB,CAAnB;;EACA,IAAI,CAACI,YAAL,EAAmB;IACf,MAAM,IAAIE,KAAJ,CAAW,WAAUN,UAAW,6BAAhC,CAAN;EACH;;EAED,MAAMO,EAAE,GAAGb,GAAG,CAACa,EAAJ,CAAOP,UAAP,CAAX;;EAEA,MAAMQ,QAAQ,GAAGjB,OAAO,CAAE,gBAAegB,EAAE,CAACE,MAAO,EAA3B,CAAxB;;EACA,MAAMC,QAAQ,GAAG,IAAIF,QAAJ,CAAad,GAAb,EAAkBC,OAAlB,EAA2BY,EAA3B,CAAjB;EAEA,MAAMjB,eAAe,CAACoB,QAAD,EAAWR,OAAX,EAAoBC,eAApB,CAArB;AACH,CArBD"}
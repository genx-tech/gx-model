{"version":3,"sources":["../../src/commands/clean.js"],"names":["path","require","_","naming","eachAsync_","del","throwIfFileNotExist","Linker","module","exports","app","context","log","name","gemlPath","linker","schemaFiles","getGemlFiles","useJsonSource","forEach","schemaFile","link","jsonFiles","join","schemas","schema","schemaName","manifestPath","modelPath","pascalCase"],"mappings":";;;;AAAA,MAAMA,IAAI,GAAGC,OAAO,CAAC,MAAD,CAApB;;AACA,MAAM;AAAEC,EAAAA,CAAF;AAAKC,EAAAA,MAAL;AAAaC,EAAAA;AAAb,IAA4BH,OAAO,CAAC,YAAD,CAAzC;;AACA,MAAMI,GAAG,GAAGJ,OAAO,CAAC,KAAD,CAAnB;;AACA,MAAM;AAAEK,EAAAA;AAAF,IAA0BL,OAAO,CAAC,kBAAD,CAAvC;;AACA,MAAMM,MAAM,GAAGN,OAAO,CAAC,gBAAD,CAAtB;;AAgBAO,MAAM,CAACC,OAAP,GAAiB,OAAOC,GAAP,EAAYC,OAAZ,KAAwB;AACrCD,EAAAA,GAAG,CAACE,GAAJ,CAAQ,SAAR,EAAoB,GAAEF,GAAG,CAACG,IAAK,QAA/B;AAEAP,EAAAA,mBAAmB,CAAC,UAAD,EAAaK,OAAO,CAACG,QAArB,CAAnB;AAEA,MAAIC,MAAM,GAAG,IAAIR,MAAJ,CAAWG,GAAX,EAAgBC,OAAhB,CAAb;AAEA,MAAIK,WAAW,GAAGT,MAAM,CAACU,YAAP,CAAoBN,OAAO,CAACG,QAA5B,EAAsCH,OAAO,CAACO,aAA9C,CAAlB;AACAF,EAAAA,WAAW,CAACG,OAAZ,CAAoBC,UAAU,IAAIL,MAAM,CAACM,IAAP,CAAYD,UAAZ,CAAlC;AAEA,QAAME,SAAS,GAAGtB,IAAI,CAACuB,IAAL,CAAUZ,OAAO,CAACG,QAAlB,EAA4B,WAA5B,CAAlB;AACA,QAAMT,GAAG,CAACiB,SAAD,CAAT;AACAZ,EAAAA,GAAG,CAACE,GAAJ,CAAQ,MAAR,EAAiB,6BAAjB;AAEA,SAAOR,UAAU,CAACW,MAAM,CAACS,OAAR,EAAiB,OAAOC,MAAP,EAAeC,UAAf,KAA8B;AAC5DhB,IAAAA,GAAG,CAACE,GAAJ,CAAQ,SAAR,EAAoB,4CAA2Cc,UAAW,OAA1E;AAEA,UAAMrB,GAAG,CAAC,CACNL,IAAI,CAACuB,IAAL,CAAUZ,OAAO,CAACgB,YAAlB,EAAgCD,UAAhC,EAA6C,MAA7C,CADM,EAEN1B,IAAI,CAACuB,IAAL,CAAUZ,OAAO,CAACgB,YAAlB,EAAgCD,UAAhC,EAA6C,QAA7C,CAFM,EAGN1B,IAAI,CAACuB,IAAL,CAAUZ,OAAO,CAACiB,SAAlB,EAA6BzB,MAAM,CAAC0B,UAAP,CAAkBH,UAAlB,IAAgC,KAA7D,CAHM,EAIN1B,IAAI,CAACuB,IAAL,CAAUZ,OAAO,CAACiB,SAAlB,EAA6BF,UAA7B,EAAyC,MAAzC,EAAiD,MAAjD,CAJM,EAKN1B,IAAI,CAACuB,IAAL,CAAUZ,OAAO,CAACiB,SAAlB,EAA6BF,UAA7B,EAAyC,QAAzC,EAAmD,MAAnD,CALM,EAMN1B,IAAI,CAACuB,IAAL,CAAUZ,OAAO,CAACiB,SAAlB,EAA6BF,UAA7B,EAAyC,OAAzC,EAAkD,MAAlD,CANM,CAAD,CAAT;AASAhB,IAAAA,GAAG,CAACE,GAAJ,CAAQ,MAAR,EAAiB,2CAA0Cc,UAAW,IAAtE;AACH,GAbgB,CAAjB;AAgBH,CA9BD","sourcesContent":["const path = require('path');\nconst { _, naming, eachAsync_ } = require('@genx/july');\nconst del = require('del');\nconst { throwIfFileNotExist } = require('../utils/helpers');\nconst Linker = require('../lang/Linker');\n\n\n/**\n * Build database scripts and entity models from oolong files.\n * @param {ServiceContainer} app\n * @param {object} context \n * @property {string} context.gemlPath\n * @property {string} context.modelPath         \n * @property {string} context.scriptPath\n * @property {string} context.manifestPath\n * @property {bool} context.useJsonSource\n * @property {bool} context.saveIntermediate\n * @property {object} context.schemas   \n * @returns {Promise}\n */\nmodule.exports = async (app, context) => {\n    app.log('verbose', `${app.name} clean`);\n\n    throwIfFileNotExist(\"gemlPath\", context.gemlPath);\n\n    let linker = new Linker(app, context);\n\n    let schemaFiles = Linker.getGemlFiles(context.gemlPath, context.useJsonSource);\n    schemaFiles.forEach(schemaFile => linker.link(schemaFile)); \n    \n    const jsonFiles = path.join(context.gemlPath, '**/*.json');\n    await del(jsonFiles);\n    app.log('info', `Deleted intermediate files.`);   \n\n    return eachAsync_(linker.schemas, async (schema, schemaName) => {      \n        app.log('verbose', `Removing auto-generated files of schema \"${schemaName}\" ...`);   \n\n        await del([\n            path.join(context.manifestPath, schemaName,  '*.js'),\n            path.join(context.manifestPath, schemaName,  '*.json'),\n            path.join(context.modelPath, naming.pascalCase(schemaName) + '.js'),\n            path.join(context.modelPath, schemaName, 'base', '*.js'),\n            path.join(context.modelPath, schemaName, 'inputs', '*.js'),\n            path.join(context.modelPath, schemaName, 'types', '*.js'),\n        ]);\n\n        app.log('info', `Removed auto-generated files of schema \"${schemaName}\".`);           \n    });            \n\n    //todo: scripts\n};\n"],"file":"clean.js"}
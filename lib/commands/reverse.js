"use strict";

require("source-map-support/register");

const path = require('path');

const {
  _,
  eachAsync_
} = require('rk-utils');

const {
  throwIfFileNotExist,
  getSchemaConnectors,
  getDateNamedDir
} = require('../utils/helpers');

module.exports = async (app, context) => {
  app.log('verbose', 'geml reverse');
  let schemaName = app.option('schema');
  let override = app.option('override');
  let schemaToConnector = getSchemaConnectors(app, context.schemas);
  let connector = schemaToConnector[schemaName];
  let basePath = path.join(context.manifestPath, 'reverse');
  let reverseOutput = getDateNamedDir(basePath, undefined, override);

  const ReserveEngineering = require(`../modeler/database/${connector.driver}/ReverseEngineering`);

  let modeler = new ReserveEngineering(app, connector);
  await modeler.reverse_(reverseOutput);
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9jb21tYW5kcy9yZXZlcnNlLmpzIl0sIm5hbWVzIjpbInBhdGgiLCJyZXF1aXJlIiwiXyIsImVhY2hBc3luY18iLCJ0aHJvd0lmRmlsZU5vdEV4aXN0IiwiZ2V0U2NoZW1hQ29ubmVjdG9ycyIsImdldERhdGVOYW1lZERpciIsIm1vZHVsZSIsImV4cG9ydHMiLCJhcHAiLCJjb250ZXh0IiwibG9nIiwic2NoZW1hTmFtZSIsIm9wdGlvbiIsIm92ZXJyaWRlIiwic2NoZW1hVG9Db25uZWN0b3IiLCJzY2hlbWFzIiwiY29ubmVjdG9yIiwiYmFzZVBhdGgiLCJqb2luIiwibWFuaWZlc3RQYXRoIiwicmV2ZXJzZU91dHB1dCIsInVuZGVmaW5lZCIsIlJlc2VydmVFbmdpbmVlcmluZyIsImRyaXZlciIsIm1vZGVsZXIiLCJyZXZlcnNlXyJdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE1BQU1BLElBQUksR0FBR0MsT0FBTyxDQUFDLE1BQUQsQ0FBcEI7O0FBQ0EsTUFBTTtBQUFFQyxFQUFBQSxDQUFGO0FBQUtDLEVBQUFBO0FBQUwsSUFBb0JGLE9BQU8sQ0FBQyxVQUFELENBQWpDOztBQUNBLE1BQU07QUFBRUcsRUFBQUEsbUJBQUY7QUFBdUJDLEVBQUFBLG1CQUF2QjtBQUE0Q0MsRUFBQUE7QUFBNUMsSUFBZ0VMLE9BQU8sQ0FBQyxrQkFBRCxDQUE3RTs7QUFlQU0sTUFBTSxDQUFDQyxPQUFQLEdBQWlCLE9BQU9DLEdBQVAsRUFBWUMsT0FBWixLQUF3QjtBQUNyQ0QsRUFBQUEsR0FBRyxDQUFDRSxHQUFKLENBQVEsU0FBUixFQUFtQixjQUFuQjtBQUVBLE1BQUlDLFVBQVUsR0FBR0gsR0FBRyxDQUFDSSxNQUFKLENBQVcsUUFBWCxDQUFqQjtBQUNBLE1BQUlDLFFBQVEsR0FBR0wsR0FBRyxDQUFDSSxNQUFKLENBQVcsVUFBWCxDQUFmO0FBRUEsTUFBSUUsaUJBQWlCLEdBQUdWLG1CQUFtQixDQUFDSSxHQUFELEVBQU1DLE9BQU8sQ0FBQ00sT0FBZCxDQUEzQztBQUNBLE1BQUlDLFNBQVMsR0FBR0YsaUJBQWlCLENBQUNILFVBQUQsQ0FBakM7QUFFQSxNQUFJTSxRQUFRLEdBQUdsQixJQUFJLENBQUNtQixJQUFMLENBQVVULE9BQU8sQ0FBQ1UsWUFBbEIsRUFBZ0MsU0FBaEMsQ0FBZjtBQUVBLE1BQUlDLGFBQWEsR0FBR2YsZUFBZSxDQUFDWSxRQUFELEVBQVdJLFNBQVgsRUFBc0JSLFFBQXRCLENBQW5DOztBQUVBLFFBQU1TLGtCQUFrQixHQUFHdEIsT0FBTyxDQUFFLHVCQUFzQmdCLFNBQVMsQ0FBQ08sTUFBTyxxQkFBekMsQ0FBbEM7O0FBQ0EsTUFBSUMsT0FBTyxHQUFHLElBQUlGLGtCQUFKLENBQXVCZCxHQUF2QixFQUE0QlEsU0FBNUIsQ0FBZDtBQUVBLFFBQU1RLE9BQU8sQ0FBQ0MsUUFBUixDQUFpQkwsYUFBakIsQ0FBTjtBQUNILENBakJEIiwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgcGF0aCA9IHJlcXVpcmUoJ3BhdGgnKTtcbmNvbnN0IHsgXywgZWFjaEFzeW5jXyB9ID0gcmVxdWlyZSgncmstdXRpbHMnKTtcbmNvbnN0IHsgdGhyb3dJZkZpbGVOb3RFeGlzdCwgZ2V0U2NoZW1hQ29ubmVjdG9ycywgZ2V0RGF0ZU5hbWVkRGlyIH0gPSByZXF1aXJlKCcuLi91dGlscy9oZWxwZXJzJyk7XG5cbi8qKlxuICogQnVpbGQgZGF0YWJhc2Ugc2NyaXB0cyBhbmQgZW50aXR5IG1vZGVscyBmcm9tIG9vbG9uZyBmaWxlcy5cbiAqIEBwYXJhbSB7U2VydmljZUNvbnRhaW5lcn0gYXBwXG4gKiBAcGFyYW0ge29iamVjdH0gY29udGV4dCBcbiAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBjb250ZXh0LmdlbWxQYXRoXG4gKiBAcHJvcGVydHkge3N0cmluZ30gY29udGV4dC5tb2RlbFBhdGggICAgICAgICBcbiAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBjb250ZXh0LnNjcmlwdFBhdGhcbiAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBjb250ZXh0Lm1hbmlmZXN0UGF0aFxuICogQHByb3BlcnR5IHtib29sfSBjb250ZXh0LnVzZUpzb25Tb3VyY2VcbiAqIEBwcm9wZXJ0eSB7Ym9vbH0gY29udGV4dC5zYXZlSW50ZXJtZWRpYXRlXG4gKiBAcHJvcGVydHkge29iamVjdH0gY29udGV4dC5zY2hlbWFzICAgXG4gKiBAcmV0dXJucyB7UHJvbWlzZX1cbiAqL1xubW9kdWxlLmV4cG9ydHMgPSBhc3luYyAoYXBwLCBjb250ZXh0KSA9PiB7XG4gICAgYXBwLmxvZygndmVyYm9zZScsICdnZW1sIHJldmVyc2UnKTtcblxuICAgIGxldCBzY2hlbWFOYW1lID0gYXBwLm9wdGlvbignc2NoZW1hJyk7XG4gICAgbGV0IG92ZXJyaWRlID0gYXBwLm9wdGlvbignb3ZlcnJpZGUnKTtcblxuICAgIGxldCBzY2hlbWFUb0Nvbm5lY3RvciA9IGdldFNjaGVtYUNvbm5lY3RvcnMoYXBwLCBjb250ZXh0LnNjaGVtYXMpO1xuICAgIGxldCBjb25uZWN0b3IgPSBzY2hlbWFUb0Nvbm5lY3RvcltzY2hlbWFOYW1lXTtcblxuICAgIGxldCBiYXNlUGF0aCA9IHBhdGguam9pbihjb250ZXh0Lm1hbmlmZXN0UGF0aCwgJ3JldmVyc2UnKTtcblxuICAgIGxldCByZXZlcnNlT3V0cHV0ID0gZ2V0RGF0ZU5hbWVkRGlyKGJhc2VQYXRoLCB1bmRlZmluZWQsIG92ZXJyaWRlKTsgICBcblxuICAgIGNvbnN0IFJlc2VydmVFbmdpbmVlcmluZyA9IHJlcXVpcmUoYC4uL21vZGVsZXIvZGF0YWJhc2UvJHtjb25uZWN0b3IuZHJpdmVyfS9SZXZlcnNlRW5naW5lZXJpbmdgKTtcbiAgICBsZXQgbW9kZWxlciA9IG5ldyBSZXNlcnZlRW5naW5lZXJpbmcoYXBwLCBjb25uZWN0b3IpO1xuXG4gICAgYXdhaXQgbW9kZWxlci5yZXZlcnNlXyhyZXZlcnNlT3V0cHV0KTtcbn07XG4iXX0=
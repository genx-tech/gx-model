{"version":3,"sources":["../../../src/migration/rules/removeAutoId.js"],"names":["_","require","applyRule","db","Entity","entity","associations","meta","forOwn","assoc","anchor","key","subEntity","list","SubEntity","model","forEach","item","autoId","features","field","module","exports"],"mappings":";;;;AAAA,MAAM;AAAEA,EAAAA;AAAF,IAAQC,OAAO,CAAC,YAAD,CAArB;;AAEA,SAASC,SAAT,CAAmBC,EAAnB,EAAuBC,MAAvB,EAA+BC,MAA/B,EAAuC;AACnC,QAAMC,YAAY,GAAGF,MAAM,CAACG,IAAP,CAAYD,YAAjC;AACAA,EAAAA,YAAY,IAAIN,CAAC,CAACQ,MAAF,CAASF,YAAT,EAAuB,CAACG,KAAD,EAAQC,MAAR,KAAmB;AACtD,UAAMC,GAAG,GAAG,MAAMD,MAAlB;AAEA,UAAME,SAAS,GAAGP,MAAM,CAACM,GAAD,CAAxB;;AACA,QAAIC,SAAJ,EAAe;AACX,UAAIH,KAAK,CAACI,IAAV,EAAgB;AAEZ,cAAMC,SAAS,GAAGX,EAAE,CAACY,KAAH,CAASN,KAAK,CAACJ,MAAf,CAAlB;AACAO,QAAAA,SAAS,CAACI,OAAV,CAAkBC,IAAI,IAAIf,SAAS,CAACC,EAAD,EAAKW,SAAL,EAAgBG,IAAhB,CAAnC;AACH,OAJD,MAIO;AAEH,cAAMH,SAAS,GAAGX,EAAE,CAACY,KAAH,CAASN,KAAK,CAACJ,MAAf,CAAlB;AACAH,QAAAA,SAAS,CAACC,EAAD,EAAKW,SAAL,EAAgBF,SAAhB,CAAT;AAEA,eAAOP,MAAM,CAACK,MAAD,CAAb;AACH;AACJ;AACJ,GAjBe,CAAhB;AAmBA,QAAMQ,MAAM,GAAGd,MAAM,CAACG,IAAP,CAAYY,QAAZ,CAAqBD,MAApC;;AAEA,MAAIA,MAAJ,EAAY;AACR,WAAOb,MAAM,CAACa,MAAM,CAACE,KAAR,CAAb;AACH;AACJ;;AAAA;AAEDC,MAAM,CAACC,OAAP,GAAiBpB,SAAjB","sourcesContent":["const { _ } = require('@genx/july');\n\nfunction applyRule(db, Entity, entity) {\n    const associations = Entity.meta.associations;\n    associations && _.forOwn(associations, (assoc, anchor) => {\n        const key = ':' + anchor;\n\n        const subEntity = entity[key];\n        if (subEntity) {\n            if (assoc.list) {\n                //array of objects\n                const SubEntity = db.model(assoc.entity);\n                subEntity.forEach(item => applyRule(db, SubEntity, item));\n            } else {\n                //object\n                const SubEntity = db.model(assoc.entity);\n                applyRule(db, SubEntity, subEntity);\n\n                delete entity[anchor];\n            }            \n        } \n    });\n\n    const autoId = Entity.meta.features.autoId;\n\n    if (autoId) {\n        delete entity[autoId.field];\n    }\n};\n\nmodule.exports = applyRule;"],"file":"removeAutoId.js"}
{"version":3,"file":"removeAutoId.js","names":["_","require","applyRule","db","Entity","entity","associations","meta","forOwn","assoc","anchor","key","subEntity","list","SubEntity","model","forEach","item","autoId","features","field","module","exports"],"sources":["../../../src/migration/rules/removeAutoId.js"],"sourcesContent":["const { _ } = require('@genx/july');\n\nfunction applyRule(db, Entity, entity) {\n    const associations = Entity.meta.associations;\n    associations && _.forOwn(associations, (assoc, anchor) => {\n        const key = ':' + anchor;\n\n        const subEntity = entity[key];\n        if (subEntity) {\n            if (assoc.list) {\n                //array of objects\n                const SubEntity = db.model(assoc.entity);\n                subEntity.forEach(item => applyRule(db, SubEntity, item));\n            } else {\n                //object\n                const SubEntity = db.model(assoc.entity);\n                applyRule(db, SubEntity, subEntity);\n\n                delete entity[anchor];\n            }            \n        } \n    });\n\n    const autoId = Entity.meta.features.autoId;\n\n    if (autoId) {\n        delete entity[autoId.field];\n    }\n};\n\nmodule.exports = applyRule;"],"mappings":";;;;AAAA,MAAM;EAAEA;AAAF,IAAQC,OAAO,CAAC,YAAD,CAArB;;AAEA,SAASC,SAAT,CAAmBC,EAAnB,EAAuBC,MAAvB,EAA+BC,MAA/B,EAAuC;EACnC,MAAMC,YAAY,GAAGF,MAAM,CAACG,IAAP,CAAYD,YAAjC;EACAA,YAAY,IAAIN,CAAC,CAACQ,MAAF,CAASF,YAAT,EAAuB,CAACG,KAAD,EAAQC,MAAR,KAAmB;IACtD,MAAMC,GAAG,GAAG,MAAMD,MAAlB;IAEA,MAAME,SAAS,GAAGP,MAAM,CAACM,GAAD,CAAxB;;IACA,IAAIC,SAAJ,EAAe;MACX,IAAIH,KAAK,CAACI,IAAV,EAAgB;QAEZ,MAAMC,SAAS,GAAGX,EAAE,CAACY,KAAH,CAASN,KAAK,CAACJ,MAAf,CAAlB;QACAO,SAAS,CAACI,OAAV,CAAkBC,IAAI,IAAIf,SAAS,CAACC,EAAD,EAAKW,SAAL,EAAgBG,IAAhB,CAAnC;MACH,CAJD,MAIO;QAEH,MAAMH,SAAS,GAAGX,EAAE,CAACY,KAAH,CAASN,KAAK,CAACJ,MAAf,CAAlB;QACAH,SAAS,CAACC,EAAD,EAAKW,SAAL,EAAgBF,SAAhB,CAAT;QAEA,OAAOP,MAAM,CAACK,MAAD,CAAb;MACH;IACJ;EACJ,CAjBe,CAAhB;EAmBA,MAAMQ,MAAM,GAAGd,MAAM,CAACG,IAAP,CAAYY,QAAZ,CAAqBD,MAApC;;EAEA,IAAIA,MAAJ,EAAY;IACR,OAAOb,MAAM,CAACa,MAAM,CAACE,KAAR,CAAb;EACH;AACJ;;AAAA;AAEDC,MAAM,CAACC,OAAP,GAAiBpB,SAAjB"}
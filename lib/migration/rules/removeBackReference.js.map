{"version":3,"sources":["../../../src/migration/rules/removeBackReference.js"],"names":["_","require","applyRule","db","Entity","entity","associations","meta","forOwn","assoc","anchor","key","subEntity","list","SubEntity","model","forEach","item","field","module","exports"],"mappings":";;;;AAAA,MAAM;AAAEA,EAAAA;AAAF,IAAQC,OAAO,CAAC,YAAD,CAArB;;AAEA,SAASC,SAAT,CAAmBC,EAAnB,EAAuBC,MAAvB,EAA+BC,MAA/B,EAAuC;AAGnC,QAAMC,YAAY,GAAGF,MAAM,CAACG,IAAP,CAAYD,YAAjC;AACAA,EAAAA,YAAY,IAAIN,CAAC,CAACQ,MAAF,CAASF,YAAT,EAAuB,CAACG,KAAD,EAAQC,MAAR,KAAmB;AACtD,UAAMC,GAAG,GAAG,MAAMD,MAAlB;AAEA,UAAME,SAAS,GAAGP,MAAM,CAACM,GAAD,CAAxB;;AACA,QAAIC,SAAJ,EAAe;AACX,UAAIH,KAAK,CAACI,IAAV,EAAgB;AAEZ,cAAMC,SAAS,GAAGX,EAAE,CAACY,KAAH,CAASN,KAAK,CAACJ,MAAf,CAAlB;AACAO,QAAAA,SAAS,CAACI,OAAV,CAAkBC,IAAI,IAAI;AACtB,iBAAOA,IAAI,CAACR,KAAK,CAACS,KAAP,CAAX;AACAhB,UAAAA,SAAS,CAACC,EAAD,EAAKW,SAAL,EAAgBG,IAAhB,CAAT;AACH,SAHD;AAIH;AACJ;AACJ,GAde,CAAhB;AAeH;;AAAA;AAEDE,MAAM,CAACC,OAAP,GAAiBlB,SAAjB","sourcesContent":["const { _ } = require('@genx/july');\n\nfunction applyRule(db, Entity, entity) {\n    //remove back reference\n\n    const associations = Entity.meta.associations;\n    associations && _.forOwn(associations, (assoc, anchor) => {\n        const key = ':' + anchor;\n\n        const subEntity = entity[key];\n        if (subEntity) {\n            if (assoc.list) {\n                //array of objects\n                const SubEntity = db.model(assoc.entity);\n                subEntity.forEach(item => { \n                    delete item[assoc.field];\n                    applyRule(db, SubEntity, item); \n                });\n            } \n        } \n    });\n};\n\nmodule.exports = applyRule;"],"file":"removeBackReference.js"}
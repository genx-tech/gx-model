{"version":3,"file":"removeBackReference.js","names":["_","require","applyRule","db","Entity","entity","associations","meta","forOwn","assoc","anchor","key","subEntity","list","SubEntity","model","forEach","item","field","module","exports"],"sources":["../../../src/migration/rules/removeBackReference.js"],"sourcesContent":["const { _ } = require('@genx/july');\n\nfunction applyRule(db, Entity, entity) {\n    //remove back reference\n\n    const associations = Entity.meta.associations;\n    associations && _.forOwn(associations, (assoc, anchor) => {\n        const key = ':' + anchor;\n\n        const subEntity = entity[key];\n        if (subEntity) {\n            if (assoc.list) {\n                //array of objects\n                const SubEntity = db.model(assoc.entity);\n                subEntity.forEach(item => { \n                    delete item[assoc.field];\n                    applyRule(db, SubEntity, item); \n                });\n            } \n        } \n    });\n};\n\nmodule.exports = applyRule;"],"mappings":";;;;AAAA,MAAM;EAAEA;AAAF,IAAQC,OAAO,CAAC,YAAD,CAArB;;AAEA,SAASC,SAAT,CAAmBC,EAAnB,EAAuBC,MAAvB,EAA+BC,MAA/B,EAAuC;EAGnC,MAAMC,YAAY,GAAGF,MAAM,CAACG,IAAP,CAAYD,YAAjC;EACAA,YAAY,IAAIN,CAAC,CAACQ,MAAF,CAASF,YAAT,EAAuB,CAACG,KAAD,EAAQC,MAAR,KAAmB;IACtD,MAAMC,GAAG,GAAG,MAAMD,MAAlB;IAEA,MAAME,SAAS,GAAGP,MAAM,CAACM,GAAD,CAAxB;;IACA,IAAIC,SAAJ,EAAe;MACX,IAAIH,KAAK,CAACI,IAAV,EAAgB;QAEZ,MAAMC,SAAS,GAAGX,EAAE,CAACY,KAAH,CAASN,KAAK,CAACJ,MAAf,CAAlB;QACAO,SAAS,CAACI,OAAV,CAAkBC,IAAI,IAAI;UACtB,OAAOA,IAAI,CAACR,KAAK,CAACS,KAAP,CAAX;UACAhB,SAAS,CAACC,EAAD,EAAKW,SAAL,EAAgBG,IAAhB,CAAT;QACH,CAHD;MAIH;IACJ;EACJ,CAde,CAAhB;AAeH;;AAAA;AAEDE,MAAM,CAACC,OAAP,GAAiBlB,SAAjB"}